HTTP/1.1 200 OK
Connection: keep-alive
Content-Length: 44227
Server: GitHub.com
Content-Type: text/html; charset=utf-8
Last-Modified: Mon, 26 Aug 2024 17:35:15 GMT
Access-Control-Allow-Origin: *
ETag: W/"66ccbcd3-3db80"
expires: Mon, 23 Sep 2024 02:30:21 GMT
Cache-Control: max-age=600
x-proxy-cache: MISS
X-GitHub-Request-Id: 5906:244A0F:13DCCCC:1495AA5:66F0D063
Accept-Ranges: bytes
Date: Mon, 23 Sep 2024 02:20:26 GMT
Via: 1.1 varnish
Age: 5
X-Served-By: cache-akl10331-AKL
X-Cache: HIT
X-Cache-Hits: 1
X-Timer: S1727058027.774897,VS0,VE2
Vary: Accept-Encoding
X-Fastly-Request-ID: 762a71959c8bd52a51d3a57d5259208bd68ec671

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="description" content="A book with scripting recipes for babashka">
<meta name="author" content="Michiel Borkent">
<title>Babashka book</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sa {
  color: #000000;
  font-weight: bold;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
<style>
  #tocbot a.toc-link.node-name--H1{ font-style: italic }
  @media screen{
    #tocbot > ul.toc-list{ margin-bottom: 0.5em; margin-left: 0.125em }
    #tocbot ul.sectlevel0, #tocbot a.toc-link.node-name--H1 + ul{
      padding-left: 0 }
    #tocbot a.toc-link{ height:100% }
    .is-collapsible{ max-height:3000px; overflow:hidden; }
    .is-collapsed{ max-height:0 }
    .is-active-link{ font-weight:700 }
  }
  @media print{
    #tocbot a.toc-link.node-name--H4{ display:none }
  }
  .toggle-button {
    display: none;
  }
  @media screen and (max-width: 767px) {
    .toggle-button {
      display: block;
      position: fixed;
      top: 0;
      right: 0;
      z-index: 1001;
      line-height: 1;
      font-size: .875rem;
      border: solid 1px #999;
      margin: 0.25rem;
      padding: 0.25rem;
      background-color: #f4f4f4;
      border-radius: .125rem;
    }
    #toc {
      display: none;
    }
    body.shownav {
      overflow: hidden;
    }
    body.shownav #toc {
      display: block;
      right: 0;
      top: 0;
      width: 280px;
      height: 100%;
      box-shadow: 0 0 5px #c8c8c8;
      padding-left: 1rem;
      position: fixed;
      background: white;
      z-index: 1000;
      overflow: scroll;
    }
  }

</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Babashka book</h1>
<div class="details">
<span id="author" class="author">Michiel Borkent</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#_target_audience">Target audience</a></li>
<li><a href="#_setting_expectations">Setting expectations</a></li>
</ul>
</li>
<li><a href="#getting_started">Getting started</a>
<ul class="sectlevel2">
<li><a href="#_installation">Installation</a></li>
<li><a href="#_building_from_source">Building from source</a></li>
<li><a href="#_running_babashka">Running babashka</a></li>
</ul>
</li>
<li><a href="#usage">Usage</a>
<ul class="sectlevel2">
<li><a href="#_running_a_script">Running a script</a></li>
<li><a href="#_current_file_path">Current file path</a></li>
<li><a href="#_parsing_command_line_arguments">Parsing command line arguments</a></li>
<li><a href="#_classpath">Classpath</a></li>
<li><a href="#main-function">Invoking a main function</a></li>
<li><a href="#_preloads">Preloads</a></li>
<li><a href="#repl">Running a REPL</a></li>
<li><a href="#_input_and_output_flags">Input and output flags</a></li>
<li><a href="#_uberscript">Uberscript</a></li>
<li><a href="#_uberjar">Uberjar</a></li>
<li><a href="#_system_properties">System properties</a></li>
<li><a href="#_data_readers">Data readers</a></li>
<li><a href="#_reader_conditionals">Reader conditionals</a></li>
<li><a href="#_invoking_clojure">Invoking clojure</a></li>
</ul>
</li>
<li><a href="#project-setup">Project setup</a>
<ul class="sectlevel2">
<li><a href="#_bb_edn">bb.edn</a></li>
<li><a href="#_paths_and_deps">:paths and :deps</a></li>
<li><a href="#_min_bb_version">:min-bb-version</a></li>
<li><a href="#_tasks">:tasks</a></li>
<li><a href="#_script_adjacent_bb_edn">Script-adjacent bb.edn</a></li>
</ul>
</li>
<li><a href="#tasks">Task runner</a>
<ul class="sectlevel2">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_talk">Talk</a></li>
<li><a href="#_task_local_options">Task-local options</a></li>
<li><a href="#_discoverability">Discoverability</a></li>
<li><a href="#_command_line_arguments">Command line arguments</a></li>
<li><a href="#_run">Run</a></li>
<li><a href="#_hooks">Hooks</a></li>
<li><a href="#_tasks_api">Tasks API</a></li>
<li><a href="#_dependencies_between_tasks">Dependencies between tasks</a></li>
<li><a href="#parallel">Parallel tasks</a></li>
<li><a href="#_invoking_a_main_function">Invoking a main function</a></li>
<li><a href="#_repl_2">REPL</a></li>
<li><a href="#_real_world_examples">Real world examples</a></li>
<li><a href="#_naming">Naming</a></li>
<li><a href="#_syntax">Syntax</a></li>
</ul>
</li>
<li><a href="#cli">Babashka CLI</a>
<ul class="sectlevel2">
<li><a href="#_x">-x</a></li>
<li><a href="#cli:exec">exec</a></li>
</ul>
</li>
<li><a href="#libraries">Libraries</a>
<ul class="sectlevel2">
<li><a href="#built-in-namespaces">Built-in namespaces</a></li>
<li><a href="#_babashka_namespaces">Babashka namespaces</a></li>
<li><a href="#_projects">Projects</a></li>
</ul>
</li>
<li><a href="#pods">Pods</a>
<ul class="sectlevel2">
<li><a href="#_pod_registry">Pod registry</a></li>
<li><a href="#_pods_in_bb_edn">Pods in bb.edn</a></li>
</ul>
</li>
<li><a href="#style">Style</a>
<ul class="sectlevel2">
<li><a href="#_explicit_requires">Explicit requires</a></li>
</ul>
</li>
<li><a href="#child_processes">Child processes</a></li>
<li><a href="#recipes">Recipes</a>
<ul class="sectlevel2">
<li><a href="#_running_tests">Running tests</a></li>
<li><a href="#main_file">Main file</a></li>
<li><a href="#_shutdown_hook">Shutdown hook</a></li>
<li><a href="#_printing_returned_values">Printing returned values</a></li>
<li><a href="#core_async">Core.async</a></li>
<li><a href="#_interacting_with_an_nrepl_server">Interacting with an nREPL server</a></li>
<li><a href="#_running_from_cygwingit_bash">Running from Cygwin/Git Bash</a></li>
</ul>
</li>
<li><a href="#differences-with-clojure">Differences with Clojure</a></li>
<li><a href="#resources">Resources</a>
<ul class="sectlevel2">
<li><a href="#_books">Books</a></li>
</ul>
</li>
<li><a href="#contributing">Contributing</a></li>
<li><a href="#license">License</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<!--<script>alert('hello')</script>-->
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="link" href="#introduction">Introduction</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Welcome reader! This is a book about scripting with Clojure and babashka.
<a href="https://www.clojure.org">Clojure</a> is a functional, dynamic programming language
from the Lisp family which runs on the JVM. Babashka is a scripting environment
made with Clojure, compiled to native with <a href="https://www.graalvm.org">GraalVM</a>. The
primary benefits of using babashka for scripting compared to the JVM are fast
startup time and low memory consumption. Babashka comes with batteries included
and packs libraries like <code>clojure.tools.cli</code> for parsing command line arguments
and <code>cheshire</code> for working with JSON. Moreover, it can be installed just by
downloading a self-contained binary.</p>
</div>
<div class="sect2">
<h3 id="_target_audience"><a class="link" href="#_target_audience">Target audience</a></h3>
<div class="paragraph">
<p>Babashka is written for developers who are familiar with Clojure on
the JVM. This book assumes familiarity with Clojure and is not a Clojure
tutorial. If you aren&#8217;t that familiar with Clojure but you&#8217;re curious to learn,
check out <a href="https://gist.github.com/yogthos/be323be0361c589570a6da4ccc85f58f">this</a>
list of beginner resources.</p>
</div>
</div>
<div class="sect2">
<h3 id="_setting_expectations"><a class="link" href="#_setting_expectations">Setting expectations</a></h3>
<div class="paragraph">
<p>Babashka uses <a href="https://github.com/babashka/SCI">SCI</a> for interpreting Clojure. SCI
implements a substantial subset of Clojure. Interpreting code is in general not
as performant as executing compiled code. If your script takes more than a few
seconds to run or has lots of loops, Clojure on the JVM may be a better fit, as
the performance on JVM is going to outweigh its startup time penalty. Read more
about the differences with Clojure <a href="#differences-with-clojure">here</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting_started"><a class="link" href="#getting_started">Getting started</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_installation"><a class="link" href="#_installation">Installation</a></h3>
<div class="paragraph">
<p>Installing babashka is as simple as downloading the binary for your platform and
placing it on your path. Pre-built binaries are provided on the
<a href="https://github.com/borkdude/babashka/releases">releases</a> page of babashka&#8217;s
<a href="https://github.com/borkdude/babashka">Github repo</a>. Babashka is also available in
various package managers like <code>brew</code> for macOS and linux and <code>scoop</code> for
Windows. See <a href="https://github.com/borkdude/babashka#installation">here</a> for
details.</p>
</div>
</div>
<div class="sect2">
<h3 id="_building_from_source"><a class="link" href="#_building_from_source">Building from source</a></h3>
<div class="paragraph">
<p>If you would rather build babashka from source, download a copy of GraalVM and
set the <code>GRAALVM_HOME</code> environment variable. Also make sure you have
<a href="https://leiningen.org">lein</a> installed. Then run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>$ git clone https://github.com/borkdude/babashka --recursive
$ script/uberjar &amp;&amp; script/compile</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the babashka <a href="https://github.com/borkdude/babashka/blob/master/doc/build.md">build.md</a> page for details.</p>
</div>
</div>
<div class="sect2">
<h3 id="_running_babashka"><a class="link" href="#_running_babashka">Running babashka</a></h3>
<div class="paragraph">
<p>The babashka executable is called <code>bb</code>. You can either provide it with a Clojure
expression directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">-e</span><span class="w"> </span><span class="o">'</span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="o">'</span><span class="w">
</span><span class="mi">6</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or run a script:</p>
</div>
<div class="listingblock">
<div class="title">script.clj</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">-f</span><span class="w"> </span><span class="n">script.clj</span><span class="w">
</span><span class="mi">6</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>-e</code> flag is optional when the argument starts with a paren. In that case babashka will treat it automatically as an expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="o">'</span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="o">'</span><span class="w">
</span><span class="mi">6</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, the <code>-f</code> flag is optional when the argument is a filename:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">script.clj</span><span class="w">
</span><span class="mi">6</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Commonly, scripts have shebangs so you can invoke them with their filename only:</p>
</div>
<div class="listingblock">
<div class="title">script.clj</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="o">#</span><span class="n">!/usr/bin/env</span><span class="w"> </span><span class="n">bb</span><span class="w">
</span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usage"><a class="link" href="#usage">Usage</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Typing <code>bb help</code> from the command line will print all the available command
line options which should give you a sense of the available features in
babashka.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Babashka v1.3.191

Usage: bb [svm-opts] [global-opts] [eval opts] [cmdline args]
or:    bb [svm-opts] [global-opts] file [cmdline args]
or:    bb [svm-opts] [global-opts] task [cmdline args]
or:    bb [svm-opts] [global-opts] subcommand [subcommand opts] [cmdline args]

Substrate VM opts:

  -Xmx&lt;size&gt;[g|G|m|M|k|K]  Set a maximum heap size (e.g. -Xmx256M to limit the heap to 256MB).
  -XX:PrintFlags=          Print all Substrate VM options.

Global opts:

  -cp, --classpath  Classpath to use. Overrides bb.edn classpath.
  --debug           Print debug information and internal stacktrace in case of exception.
  --init &lt;file&gt;     Load file after any preloads and prior to evaluation/subcommands.
  --config &lt;file&gt;   Replace bb.edn with file. Defaults to bb.edn adjacent to invoked file or bb.edn in current dir. Relative paths are resolved relative to bb.edn.
  --deps-root &lt;dir&gt; Treat dir as root of relative paths in config.
  --prn             Print result via clojure.core/prn
  -Sforce           Force recalculation of the classpath (don't use the cache)
  -Sdeps            Deps data to use as the last deps file to be merged
  -f, --file &lt;path&gt; Run file
  --jar &lt;path&gt;      Run uberjar

Help:

  help, -h or -?     Print this help text.
  version            Print the current version of babashka.
  describe           Print an EDN map with information about this version of babashka.
  doc &lt;var|ns&gt;       Print docstring of var or namespace. Requires namespace if necessary.

Evaluation:

  -e, --eval &lt;expr&gt;    Evaluate an expression.
  -m, --main &lt;ns|var&gt;  Call the -main function from a namespace or call a fully qualified var.
  -x, --exec &lt;var&gt;     Call the fully qualified var. Args are parsed by babashka CLI.

REPL:

  repl                 Start REPL. Use rlwrap for history.
  socket-repl  [addr]  Start a socket REPL. Address defaults to localhost:1666.
  nrepl-server [addr]  Start nREPL server. Address defaults to localhost:1667.

Tasks:

  tasks       Print list of available tasks.
  run &lt;task&gt;  Run task. See run --help for more details.

Clojure:

  clojure [args...]  Invokes clojure. Takes same args as the official clojure CLI.

Packaging:

  uberscript &lt;file&gt; [eval-opt]  Collect all required namespaces from the classpath into a single file. Accepts additional eval opts, like `-m`.
  uberjar    &lt;jar&gt;  [eval-opt]  Similar to uberscript but creates jar file.
  prepare                       Download deps &amp; pods defined in bb.edn and cache their metadata. Only an optimization, this will happen on demand when needed.

In- and output flags (only to be used with -e one-liners):

  -i                 Bind *input* to a lazy seq of lines from stdin.
  -I                 Bind *input* to a lazy seq of EDN values from stdin.
  -o                 Write lines to stdout.
  -O                 Write EDN values to stdout.
  --stream           Stream over lines or EDN values from stdin. Combined with -i or -I *input* becomes a single value per iteration.

Tooling:

  print-deps [--format &lt;deps | classpath&gt;]: prints a deps.edn map or classpath
    with built-in deps and deps from bb.edn.

File names take precedence over subcommand names.
Remaining arguments are bound to *command-line-args*.
Use -- to separate script command line args from bb command line args.
When no eval opts or subcommand is provided, the implicit subcommand is repl.</pre>
</div>
</div>
<div class="sect2">
<h3 id="_running_a_script"><a class="link" href="#_running_a_script">Running a script</a></h3>
<div class="paragraph">
<p>Scripts may be executed from a file using <code>-f</code> or <code>--file</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">bb <span class="nt">-f</span> download_html.clj</code></pre>
</div>
</div>
<div class="paragraph">
<p>The file may also be passed directly, without <code>-f</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">bb download_html.clj</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using <code>bb</code> with a shebang also works:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="o">#</span><span class="n">!/usr/bin/env</span><span class="w"> </span><span class="n">bb</span><span class="w">

</span><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">babashka.http-client</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">http</span><span class="p">])</span><span class="w">

</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">get-url</span><span class="w"> </span><span class="p">[</span><span class="n">url</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="s">"Downloading url:"</span><span class="w"> </span><span class="n">url</span><span class="p">)</span><span class="w">
  </span><span class="p">(</span><span class="nf">http/get</span><span class="w"> </span><span class="n">url</span><span class="p">))</span><span class="w">

</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">write-html</span><span class="w"> </span><span class="p">[</span><span class="n">file</span><span class="w"> </span><span class="n">html</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="s">"Writing file:"</span><span class="w"> </span><span class="n">file</span><span class="p">)</span><span class="w">
  </span><span class="p">(</span><span class="nf">spit</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">html</span><span class="p">))</span><span class="w">

</span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[[</span><span class="n">url</span><span class="w"> </span><span class="n">file</span><span class="p">]</span><span class="w"> </span><span class="n">*command-line-args*</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nb">when</span><span class="w"> </span><span class="p">(</span><span class="nb">or</span><span class="w"> </span><span class="p">(</span><span class="nf">empty?</span><span class="w"> </span><span class="n">url</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">empty?</span><span class="w"> </span><span class="n">file</span><span class="p">))</span><span class="w">
    </span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="s">"Usage: &lt;url&gt; &lt;file&gt;"</span><span class="p">)</span><span class="w">
    </span><span class="p">(</span><span class="nf">System/exit</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w">
  </span><span class="p">(</span><span class="nf">write-html</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="p">(</span><span class="no">:body</span><span class="w"> </span><span class="p">(</span><span class="nf">get-url</span><span class="w"> </span><span class="n">url</span><span class="p">))))</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>./download_html.clj
Usage: &lt;url&gt; &lt;file&gt;

<span class="nv">$ </span>./download_html.clj https://www.clojure.org /tmp/clojure.org.html
Downloading url: https://www.clojure.org
Writing file: /tmp/clojure.org.html</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>/usr/bin/env</code> doesn&#8217;t work for you, you can use the following
workaround:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">cat </span>script.clj
<span class="c">#!/bin/sh</span>

<span class="c">#_(</span>
   <span class="s2">"exec"</span> <span class="s2">"bb"</span> <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span> hello <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
   <span class="o">)</span>

<span class="o">(</span>prn <span class="k">*</span>command-line-args<span class="k">*</span><span class="o">)</span>

./script.clj 1 2 3
<span class="o">(</span><span class="s2">"hello"</span> <span class="s2">"1"</span> <span class="s2">"2"</span> <span class="s2">"3"</span><span class="o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_current_file_path"><a class="link" href="#_current_file_path">Current file path</a></h3>
<div class="paragraph">
<p>The var <code>*file*</code> contains the full path of the file that is currently
being executed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">cat </span>example.clj
<span class="o">(</span>prn <span class="k">*</span>file<span class="k">*</span><span class="o">)</span>

<span class="nv">$ </span>bb example.clj
<span class="s2">"/Users/borkdude/example.clj"</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_parsing_command_line_arguments"><a class="link" href="#_parsing_command_line_arguments">Parsing command line arguments</a></h3>
<div class="paragraph">
<p>Command-line arguments can be retrieved using <code>*command-line-args*</code>. If you
want to parse command line arguments, you can use the built-in
<a href="https://github.com/babashka/cli"><code>babashka.cli</code></a> namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">babashka.cli</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">cli</span><span class="p">])</span><span class="w">

</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">cli-options</span><span class="w"> </span><span class="p">{</span><span class="no">:port</span><span class="w"> </span><span class="p">{</span><span class="no">:default</span><span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="no">:coerce</span><span class="w"> </span><span class="no">:long</span><span class="p">}</span><span class="w">
                  </span><span class="no">:help</span><span class="w"> </span><span class="p">{</span><span class="no">:coerce</span><span class="w"> </span><span class="no">:boolean</span><span class="p">}})</span><span class="w">

</span><span class="p">(</span><span class="nb">prn</span><span class="w"> </span><span class="p">(</span><span class="nf">cli/parse-opts</span><span class="w"> </span><span class="n">*command-line-args*</span><span class="w"> </span><span class="p">{</span><span class="no">:spec</span><span class="w"> </span><span class="n">cli-options</span><span class="p">}))</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>bb script.clj
<span class="o">{</span>:port 80<span class="o">}</span>
<span class="nv">$ </span>bb script.clj <span class="nt">--port</span> 1223
<span class="o">{</span>:port 1223<span class="o">}</span>
<span class="nv">$ </span>bb script.clj <span class="nt">--help</span>
<span class="o">{</span>:port 80, :help <span class="nb">true</span><span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <a href="https://github.com/clojure/tools.cli">clojure.tools.cli</a> is also built-in to babashka.</p>
</div>
</div>
<div class="sect2">
<h3 id="_classpath"><a class="link" href="#_classpath">Classpath</a></h3>
<div class="paragraph">
<p>It is recommended to use <code>bb.edn</code> to control what directories and libraries are
included on babashka&#8217;s classpath. See <a href="#project-setup">Project setup</a></p>
</div>
<div class="paragraph">
<p>If you want a lower level to control
babashka&#8217;s classpath, without the usage of <code>bb.edn</code> you can use the
<code>--classpath</code> option that will override the classpath.  Say we have a file
<code>script/my/namespace.clj</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">ns</span><span class="w"> </span><span class="n">my.namespace</span><span class="p">)</span><span class="w">
</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">-main</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="w"> </span><span class="n">args</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="nb">println</span><span class="w"> </span><span class="s">"Hello from my namespace!"</span><span class="w"> </span><span class="n">args</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can execute this main function with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">--classpath</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="n">--main</span><span class="w"> </span><span class="n">my.namespace</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span><span class="n">Hello</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">my</span><span class="w"> </span><span class="n">namespace!</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have a larger script with a classic Clojure project layout like</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>tree <span class="nt">-L</span> 3
 deps.edn
 README
 src
  project_namespace
      main.clj
      utilities.clj
 <span class="nb">test</span>
     project_namespace
         test_main.clj
         test_utilities.clj</code></pre>
</div>
</div>
<div class="paragraph">
<p>then you can tell babashka to include both the <code>src</code> and <code>test</code> folders
in the classpath and start a socket REPL by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>bb <span class="nt">--classpath</span> src:test socket-repl 1666</code></pre>
</div>
</div>
<div class="paragraph">
<p>If there is no <code>--classpath</code> argument, the <code>BABASHKA_CLASSPATH</code> environment
variable will be used. If that variable isn&#8217;t set either, babashka will use
<code>:deps</code> and <code>:paths</code> from <code>bb.edn</code>.</p>
</div>
<div class="paragraph">
<p>Also see the <a href="#babashka_classpath">babashka.classpath</a>
namespace which allows dynamically adding to the classpath.</p>
</div>
<div class="paragraph">
<p>The namespace <a href="#babashkadeps">babashka.deps</a> integrates
<a href="https://github.com/clojure/tools.deps.alpha">tools.deps</a> with babashka and allows
you to set the classpath using a <code>deps.edn</code> map.</p>
</div>
</div>
<div class="sect2">
<h3 id="main-function"><a class="link" href="#main-function">Invoking a main function</a></h3>
<div class="paragraph">
<p>A main function can be invoked with <code>-m</code> or <code>--main</code> like shown above. When
given the argument <code>foo.bar</code>, the namespace <code>foo.bar</code> will be required and the
function <code>foo.bar/-main</code> will be called with command line arguments as strings.</p>
</div>
<div class="paragraph">
<p>Since babashka 0.3.1 you may pass a fully qualified symbol to <code>-m</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">-m</span><span class="w"> </span><span class="n">clojure.core/prn</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span><span class="s">"1"</span><span class="w"> </span><span class="s">"2"</span><span class="w"> </span><span class="s">"3"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>so you can execute any function as a main function, as long as it accepts
the number of provided arguments.</p>
</div>
<div class="paragraph">
<p>When invoking <code>bb</code> with a main function, the expression <code>(System/getProperty
"babashka.main")</code> will return the name of the main function.</p>
</div>
</div>
<div class="sect2">
<h3 id="_preloads"><a class="link" href="#_preloads">Preloads</a></h3>
<div class="paragraph">
<p>The environment variable <code>BABASHKA_PRELOADS</code> allows to define code that
will be available in all subsequent usages of babashka.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">BABASHKA_PRELOADS</span><span class="o">=</span><span class="s1">'(defn foo [x] (+ x 2))'</span>
<span class="nv">BABASHKA_PRELOADS</span><span class="o">=</span><span class="nv">$BABASHKA_PRELOADS</span><span class="s1">' (defn bar [x] (* x 2))'</span>
<span class="nb">export </span>BABASHKA_PRELOADS</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can concatenate multiple expressions. Now you can use
these functions in babashka:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>bb <span class="s1">'(-&gt; (foo *input*) bar)'</span> <span class="o">&lt;&lt;&lt;</span> 1
6</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also preload an entire file using <code>load-file</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">export </span><span class="nv">BABASHKA_PRELOADS</span><span class="o">=</span><span class="s1">'(load-file "my_awesome_prelude.clj")'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>*input*</code> is not available in preloads.</p>
</div>
</div>
<div class="sect2">
<h3 id="repl"><a class="link" href="#repl">Running a REPL</a></h3>
<div class="paragraph">
<p>Babashka supports running a REPL, a socket REPL and an nREPL server.</p>
</div>
<div class="sect3">
<h4 id="_repl"><a class="link" href="#_repl">REPL</a></h4>
<div class="paragraph">
<p>To start a REPL, type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>bb repl</code></pre>
</div>
</div>
<div class="paragraph">
<p>To get history with up and down arrows, use <a href="https://github.com/hanslub42/rlwrap">rlwrap</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>rlwrap bb repl</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_socket_repl"><a class="link" href="#_socket_repl">Socket REPL</a></h4>
<div class="paragraph">
<p>To start a socket REPL on port <code>1666</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>bb socket-repl 1666
Babashka socket REPL started at localhost:1666</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can connect with your favorite socket REPL client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>rlwrap nc 127.0.0.1 1666
Babashka v0.0.14 REPL.
Use :repl/quit or :repl/exit to quit the REPL.
Clojure rocks, Bash reaches.

<span class="nv">bb</span><span class="o">=&gt;</span> <span class="o">(</span>+ 1 2 3<span class="o">)</span>
6
<span class="nv">bb</span><span class="o">=&gt;</span> :repl/quit
<span class="err">$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>--socket-repl</code> option takes options similar to the <code>clojure.server.repl</code>
Java property option in Clojure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">socket-repl</span><span class="w"> </span><span class="o">'</span><span class="p">{</span><span class="no">:address</span><span class="w"> </span><span class="s">"0.0.0.0"</span><span class="w"> </span><span class="no">:accept</span><span class="w"> </span><span class="n">clojure.core.server/repl</span><span class="w"> </span><span class="no">:port</span><span class="w"> </span><span class="mi">1666</span><span class="p">}</span><span class="o">'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Editor plugins and tools known to work with a babashka socket REPL:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Emacs: <a href="https://github.com/clojure-emacs/inf-clojure">inf-clojure</a>:</p>
<div class="paragraph">
<p>To connect:</p>
</div>
<div class="paragraph">
<p><code>M-x inf-clojure-connect &lt;RET&gt; localhost &lt;RET&gt; 1666</code></p>
</div>
<div class="paragraph">
<p>Before evaluating from a Clojure buffer:</p>
</div>
<div class="paragraph">
<p><code>M-x inf-clojure-minor-mode</code></p>
</div>
</li>
<li>
<p>Atom: <a href="https://github.com/mauricioszabo/atom-chlorine">Chlorine</a></p>
</li>
<li>
<p>Vim: <a href="https://github.com/liquidz/vim-iced">vim-iced</a></p>
</li>
<li>
<p>IntelliJ IDEA: <a href="https://cursive-ide.com/">Cursive</a></p>
<div class="paragraph">
<p>Note: you will have to use a workaround via
<a href="https://github.com/mfikes/tubular">tubular</a>. For more info, look
<a href="https://cursive-ide.com/userguide/repl.html#repl-types">here</a>.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_prepl"><a class="link" href="#_prepl">pREPL</a></h4>
<div class="paragraph">
<p>Launching a prepl can be done as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">socket-repl</span><span class="w"> </span><span class="o">'</span><span class="p">{</span><span class="no">:address</span><span class="w"> </span><span class="s">"0.0.0.0"</span><span class="w"> </span><span class="no">:accept</span><span class="w"> </span><span class="n">clojure.core.server/io-prepl</span><span class="w"> </span><span class="no">:port</span><span class="w"> </span><span class="mi">1666</span><span class="p">}</span><span class="o">'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or programmatically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">-e</span><span class="w"> </span><span class="o">'</span><span class="p">(</span><span class="nf">clojure.core.server/io-prepl</span><span class="p">)</span><span class="o">'</span><span class="w">
</span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="no">:tag</span><span class="w"> </span><span class="no">:ret,</span><span class="w"> </span><span class="no">:val</span><span class="w"> </span><span class="s">"6"</span><span class="n">,</span><span class="w"> </span><span class="no">:ns</span><span class="w"> </span><span class="s">"user"</span><span class="n">,</span><span class="w"> </span><span class="no">:ms</span><span class="w"> </span><span class="mi">0</span><span class="n">,</span><span class="w"> </span><span class="no">:form</span><span class="w"> </span><span class="s">"(+ 1 2 3)"</span><span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_nrepl"><a class="link" href="#_nrepl">nREPL</a></h4>
<div class="paragraph">
<p>To start an nREPL server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>bb nrepl-server 1667</code></pre>
</div>
</div>
<div class="paragraph">
<p>or programmatically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">-e</span><span class="w"> </span><span class="s">"(babashka.nrepl.server/start-server\!) (deref (promise))"</span><span class="w">
</span><span class="n">Started</span><span class="w"> </span><span class="n">nREPL</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mf">0.0</span><span class="n">.0.0</span><span class="no">:1667</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then connect with your favorite nREPL client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">lein</span><span class="w"> </span><span class="n">repl</span><span class="w"> </span><span class="no">:connect</span><span class="w"> </span><span class="mi">1667</span><span class="w">
</span><span class="n">Connecting</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">nREPL</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mf">127.0</span><span class="n">.0.1</span><span class="no">:1667</span><span class="w">
</span><span class="n">user=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w">
</span><span class="mi">6</span><span class="w">
</span><span class="n">user=&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Editor plugins and tools known to work with the babashka nREPL server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Emacs: <a href="https://docs.cider.mx/cider/platforms/babashka.html">CIDER</a></p>
</li>
<li>
<p><code>lein repl :connect</code></p>
</li>
<li>
<p>VSCode: <a href="http://calva.io/">Calva</a></p>
</li>
<li>
<p>Atom: <a href="https://github.com/mauricioszabo/atom-chlorine">Chlorine</a></p>
</li>
<li>
<p>(Neo)Vim: <a href="https://github.com/liquidz/vim-iced">vim-iced</a>,
<a href="https://github.com/Olical/conjure">conjure</a>,
<a href="https://github.com/tpope/vim-fireplace">fireplace</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The babashka nREPL server currently does not write an <code>.nrepl-port</code> file at
startup. Using the following <code>nrepl</code> task, defined in a <code>bb.edn</code>, you can
accomplish the same:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:tasks</span><span class="w">
 </span><span class="p">{</span><span class="n">nrepl</span><span class="w">
  </span><span class="p">{</span><span class="no">:requires</span><span class="w"> </span><span class="p">([</span><span class="n">babashka.fs</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">fs</span><span class="p">]</span><span class="w">
              </span><span class="p">[</span><span class="n">babashka.nrepl.server</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">srv</span><span class="p">])</span><span class="w">
   </span><span class="no">:task</span><span class="w"> </span><span class="p">(</span><span class="nf">do</span><span class="w"> </span><span class="p">(</span><span class="nf">srv/start-server!</span><span class="w"> </span><span class="p">{</span><span class="no">:host</span><span class="w"> </span><span class="s">"localhost"</span><span class="w">
                                 </span><span class="no">:port</span><span class="w"> </span><span class="mi">1339</span><span class="p">})</span><span class="w">
             </span><span class="p">(</span><span class="nf">spit</span><span class="w"> </span><span class="s">".nrepl-port"</span><span class="w"> </span><span class="s">"1339"</span><span class="p">)</span><span class="w">
             </span><span class="p">(</span><span class="nb">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">Runtime/getRuntime</span><span class="p">)</span><span class="w">
                 </span><span class="p">(</span><span class="nf">.addShutdownHook</span><span class="w">
                  </span><span class="p">(</span><span class="nf">Thread.</span><span class="w"> </span><span class="p">(</span><span class="k">fn</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="p">(</span><span class="nf">fs/delete</span><span class="w"> </span><span class="s">".nrepl-port"</span><span class="p">)))))</span><span class="w">
             </span><span class="p">(</span><span class="nb">deref</span><span class="w"> </span><span class="p">(</span><span class="nf">promise</span><span class="p">)))}}}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>babashka.nrepl.server</code> API is exposed since version 0.8.157.</p>
</div>
<div class="sect4">
<h5 id="_debugging_the_nrepl_server"><a class="link" href="#_debugging_the_nrepl_server">Debugging the nREPL server</a></h5>
<div class="paragraph">
<p>To debug the nREPL server from the binary you can run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ BABASHKA_DEV</span><span class="o">=</span><span class="nb">true </span>bb nrepl-server 1667</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will print all the incoming messages.</p>
</div>
<div class="paragraph">
<p>To debug the nREPL server from source:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="n">https</span><span class="no">://github.com/borkdude/babashka</span><span class="w"> </span><span class="n">--recurse-submodules</span><span class="w">
</span><span class="n">$</span><span class="w"> </span><span class="n">cd</span><span class="w"> </span><span class="n">babashka</span><span class="w">
</span><span class="n">$</span><span class="w"> </span><span class="n">BABASHKA_DEV=true</span><span class="w"> </span><span class="n">clojure</span><span class="w"> </span><span class="n">-A</span><span class="no">:main</span><span class="w"> </span><span class="n">--nrepl-server</span><span class="w"> </span><span class="mi">1667</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_repl_server_port"><a class="link" href="#_repl_server_port">REPL server port</a></h4>
<div class="paragraph">
<p>For the socket REPL, pREPL, or nREPL, if a randomized port is needed, 0 can be used anywhere a port argument is accepted.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_input_and_output_flags"><a class="link" href="#_input_and_output_flags">Input and output flags</a></h3>
<div class="paragraph">
<p>In one-liners the <code>*input*</code> value may come in handy. It contains the
input read from stdin as EDN by default. If you want to read in text,
use the <code>-i</code> flag, which binds <code>*input*</code> to a lazy seq of lines of text.
If you want to read multiple EDN values, use the <code>-I</code> flag. The <code>-o</code>
option prints the result as lines of text. The <code>-O</code> option prints the
result as lines of EDN values.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>*input*</code> is only available in the <code>user</code> namespace, designed
for one-liners. For writing scripts, see <a href="#_scripts">Scripts</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following table illustrates the combination of options for commands
of the form</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo "{{Input}}" | bb {{Input flags}} {{Output flags}} "*input*"</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Input</th>
<th class="tableblock halign-left valign-top">Input flags</th>
<th class="tableblock halign-left valign-top">Output flag</th>
<th class="tableblock halign-left valign-top"><code>*input*</code></th>
<th class="tableblock halign-left valign-top">Output</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{:a 1}</code> <code>{:a 2}</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{:a 1}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{:a 1}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hello<br>
bye</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-i</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>("hello" "bye")</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>("hello" "bye")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hello<br>
bye</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>("hello" "bye")</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hello<br>
bye</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{:a 1} {:a 2}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-I</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>({:a 1} {:a 2})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>({:a 1} {:a 2})</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{:a 1} {:a 2}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-I</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-O</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>({:a 1} {:a 2})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{:a 1} {:a 2}</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When combined with the <code>--stream</code> option, the expression is executed for
each value in the input:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">echo</span><span class="w"> </span><span class="o">'</span><span class="p">{</span><span class="no">:a</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="no">:a</span><span class="w"> </span><span class="mi">2</span><span class="p">}</span><span class="o">'</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">--stream</span><span class="w"> </span><span class="ss">'*input*</span><span class="o">'</span><span class="w">
</span><span class="p">{</span><span class="no">:a</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="no">:a</span><span class="w"> </span><span class="mi">2</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_scripts"><a class="link" href="#_scripts">Scripts</a></h4>
<div class="paragraph">
<p>When writing scripts instead of one-liners on the command line, it is
not recommended to use <code>*input*</code>. Here is how you can rewrite to
standard Clojure code.</p>
</div>
</div>
<div class="sect3">
<h4 id="_edn_input"><a class="link" href="#_edn_input">EDN input</a></h4>
<div class="paragraph">
<p>Reading a single EDN value from stdin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">ns</span><span class="w"> </span><span class="n">script</span><span class="w">
 </span><span class="p">(</span><span class="no">:require</span><span class="w"> </span><span class="p">[</span><span class="n">clojure.edn</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">edn</span><span class="p">]))</span><span class="w">

</span><span class="p">(</span><span class="nf">edn/read</span><span class="w"> </span><span class="n">*in*</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Reading multiple EDN values from stdin (the <code>-I</code> flag):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">ns</span><span class="w"> </span><span class="n">script</span><span class="w">
 </span><span class="p">(</span><span class="no">:require</span><span class="w"> </span><span class="p">[</span><span class="n">clojure.edn</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">edn</span><span class="p">]</span><span class="w">
           </span><span class="p">[</span><span class="n">clojure.java.io</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">io</span><span class="p">]))</span><span class="w">

</span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">reader</span><span class="w">  </span><span class="p">(</span><span class="nf">java.io.PushbackReader.</span><span class="w"> </span><span class="p">(</span><span class="nf">io/reader</span><span class="w"> </span><span class="n">*in*</span><span class="p">))]</span><span class="w">
  </span><span class="p">(</span><span class="nb">take-while</span><span class="w"> </span><span class="o">#</span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nb">identical?</span><span class="w"> </span><span class="no">::eof</span><span class="w"> </span><span class="n">%</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="nf">repeatedly</span><span class="w"> </span><span class="o">#</span><span class="p">(</span><span class="nf">edn/read</span><span class="w"> </span><span class="p">{</span><span class="no">:eof</span><span class="w"> </span><span class="no">::eof</span><span class="p">}</span><span class="w"> </span><span class="n">reader</span><span class="p">))))</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_text_input"><a class="link" href="#_text_input">Text input</a></h4>
<div class="paragraph">
<p>Reading text from stdin can be done with <code>(slurp *in*)</code>. To get a lazy
seq of lines (the <code>-i</code> flag), you can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">ns</span><span class="w"> </span><span class="n">script</span><span class="w">
 </span><span class="p">(</span><span class="no">:require</span><span class="w"> </span><span class="p">[</span><span class="n">clojure.java.io</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">io</span><span class="p">]))</span><span class="w">

</span><span class="p">(</span><span class="nb">line-seq</span><span class="w"> </span><span class="p">(</span><span class="nf">io/reader</span><span class="w"> </span><span class="n">*in*</span><span class="p">))</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_output"><a class="link" href="#_output">Output</a></h4>
<div class="paragraph">
<p>To print to stdout, use <code>println</code> for text and <code>prn</code> for EDN values.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_uberscript"><a class="link" href="#_uberscript">Uberscript</a></h3>
<div class="paragraph">
<p>The <code>--uberscript</code> option collects the expressions in
<code>BABASHKA_PRELOADS</code>, the command line expression or file, the main
entrypoint and all required namespaces from the classpath into a single
file. This can be convenient for debugging and deployment.</p>
</div>
<div class="paragraph">
<p>Here is an example that uses a function from the
<a href="https://github.com/clj-commons/fs">clj-commons/fs</a> library.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s first set the classpath:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="n">BABASHKA_CLASSPATH=$</span><span class="p">(</span><span class="nf">clojure</span><span class="w"> </span><span class="n">-Spath</span><span class="w"> </span><span class="n">-Sdeps</span><span class="w"> </span><span class="o">'</span><span class="p">{</span><span class="no">:deps</span><span class="w"> </span><span class="p">{</span><span class="n">clj-commons/fs</span><span class="w"> </span><span class="p">{</span><span class="no">:mvn/version</span><span class="w"> </span><span class="s">"1.6.307"</span><span class="p">}}}</span><span class="o">'</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Write a little script, say <code>glob.clj</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">ns</span><span class="w"> </span><span class="n">glob</span><span class="w"> </span><span class="p">(</span><span class="no">:require</span><span class="w"> </span><span class="p">[</span><span class="n">me.raynes.fs</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">fs</span><span class="p">]))</span><span class="w">

</span><span class="p">(</span><span class="nf">run!</span><span class="w"> </span><span class="p">(</span><span class="nb">comp</span><span class="w"> </span><span class="nb">println</span><span class="w"> </span><span class="nb">str</span><span class="p">)</span><span class="w">
      </span><span class="p">(</span><span class="nf">fs/glob</span><span class="w"> </span><span class="p">(</span><span class="nb">first</span><span class="w"> </span><span class="n">*command-line-args*</span><span class="p">)))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For testing, we&#8217;ll make a file which we will find using the glob function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">touch </span>README.md</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can execute the script which uses the library:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">time </span>bb glob.clj <span class="s1">'*.md'</span>
/private/tmp/glob/README.md
bb glob.clj <span class="s1">'*.md'</span>   0.03s  user 0.01s system 88% cpu 0.047 total</code></pre>
</div>
</div>
<div class="paragraph">
<p>Producing an uberscript with all required code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>bb uberscript glob-uberscript.clj glob.clj</code></pre>
</div>
</div>
<div class="paragraph">
<p>To prove that we don&#8217;t need the classpath anymore:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">unset </span>BABASHKA_CLASSPATH
<span class="nv">$ </span><span class="nb">time </span>bb glob-uberscript.clj <span class="s1">'*.md'</span>
/private/tmp/glob/README.md
bb glob-uberscript.clj <span class="s1">'*.md'</span>   0.03s  user 0.02s system 93% cpu 0.049 total</code></pre>
</div>
</div>
<div class="paragraph">
<p>Caveats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Dynamic requires</em>. Building uberscripts works by running top-level
<code>ns</code> and <code>require</code> forms. The rest of the code is not evaluated. Code
that relies on dynamic requires may not work in an uberscript.</p>
</li>
<li>
<p><em>Resources</em>. The usage of <code>io/resource</code> assumes a classpath, so when
this is used in your uberscript, you still have to set a classpath and
bring the resources along.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If any of the above is problematic for your project, using an
<a href="#uberjar">uberjar</a> is a good alternative.</p>
</div>
<div class="sect3">
<h4 id="_carve"><a class="link" href="#_carve">Carve</a></h4>
<div class="paragraph">
<p>Uberscripts can be optimized by cutting out unused vars with
<a href="https://github.com/borkdude/carve">carve</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">wc</span> <span class="nt">-l</span> glob-uberscript.clj
     583 glob-uberscript.clj
<span class="nv">$ </span>carve <span class="nt">--opts</span> <span class="s1">'{:paths ["glob-uberscript.clj"] :aggressive true :silent true}'</span>
<span class="nv">$ </span><span class="nb">wc</span> <span class="nt">-l</span> glob-uberscript.clj
     105 glob-uberscript.clj</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the uberscript became 72% shorter. This has a beneficial
effect on execution time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">time </span>bb glob-uberscript.clj <span class="s1">'*.md'</span>
/private/tmp/glob/README.md
bb glob-uberscript.clj <span class="s1">'*.md'</span>   0.02s  user 0.01s system 84% cpu 0.034 total</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_uberjar"><a class="link" href="#_uberjar">Uberjar</a></h3>
<div class="paragraph">
<p>Babashka can create uberjars from a given classpath and optionally a
main method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">bb/foo.clj</span><span class="w">
</span><span class="p">(</span><span class="nf">ns</span><span class="w"> </span><span class="n">foo</span><span class="p">)</span><span class="w">
</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">-main</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="w"> </span><span class="n">args</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="nb">prn</span><span class="w"> </span><span class="no">:hello</span><span class="p">))</span><span class="w">
</span><span class="n">$</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">bb.edn</span><span class="w">
</span><span class="p">{</span><span class="no">:paths</span><span class="w"> </span><span class="p">[</span><span class="s">"bb"</span><span class="p">]}</span><span class="w">
</span><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">uberjar</span><span class="w"> </span><span class="n">foo.jar</span><span class="w"> </span><span class="n">-m</span><span class="w"> </span><span class="n">foo</span><span class="w">
</span><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">foo.jar</span><span class="w">
</span><span class="no">:hello</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_system_properties"><a class="link" href="#_system_properties">System properties</a></h3>
<div class="paragraph">
<p>Babashka sets the following system properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>babashka.version</code>: the version string, e.g. <code>"1.2.0"</code></p>
</li>
<li>
<p><code>babashka.main</code>: the <code>--main</code> argument</p>
</li>
<li>
<p><code>babashka.file</code>: the <code>--file</code> argument (normalized using
<code>.getAbsolutePath</code>)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_data_readers"><a class="link" href="#_data_readers">Data readers</a></h3>
<div class="paragraph">
<p>Data readers can be enabled by setting <code>*data-readers*</code> to a hashmap of
symbols to functions or vars:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">-e</span><span class="w"> </span><span class="s">"(set! *data-readers* {'t/tag inc}) #t/tag 1"</span><span class="w">
</span><span class="mi">2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To preserve good startup time, babashka does not scan the classpath for
<code>data_readers.clj</code> files.</p>
</div>
</div>
<div class="sect2">
<h3 id="_reader_conditionals"><a class="link" href="#_reader_conditionals">Reader conditionals</a></h3>
<div class="paragraph">
<p>Babashka supports reader conditionals by taking either the <code>:bb</code> or
<code>:clj</code> branch, whichever comes first. NOTE: the <code>:clj</code> branch behavior
was added in version 0.0.71, before that version the <code>:clj</code> branch was
ignored.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">-e</span><span class="w"> </span><span class="s">"#?(:bb :hello :clj :bye)"</span><span class="w">
</span><span class="no">:hello</span><span class="w">

</span><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">-e</span><span class="w"> </span><span class="s">"#?(:clj :bye :bb :hello)"</span><span class="w">
</span><span class="no">:bye</span><span class="w">

</span><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">-e</span><span class="w"> </span><span class="s">"[1 2 #?@(:bb [] :clj [1])]"</span><span class="w">
</span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_invoking_clojure"><a class="link" href="#_invoking_clojure">Invoking clojure</a></h3>
<div class="paragraph">
<p>Babashka bundles <a href="https://github.com/borkdude/deps.clj">deps.clj</a> for invoking a
<code>clojure</code> JVM process:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">clojure</span><span class="w"> </span><span class="n">-M</span><span class="w"> </span><span class="n">-e</span><span class="w"> </span><span class="s">"*clojure-version*"</span><span class="w">
</span><span class="p">{</span><span class="no">:major</span><span class="w"> </span><span class="mi">1</span><span class="n">,</span><span class="w"> </span><span class="no">:minor</span><span class="w"> </span><span class="mi">10</span><span class="n">,</span><span class="w"> </span><span class="no">:incremental</span><span class="w"> </span><span class="mi">1</span><span class="n">,</span><span class="w"> </span><span class="no">:qualifier</span><span class="w"> </span><span class="n">nil</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="#_clojure">clojure</a> function in the
<a href="#babashkadeps">babashka.deps</a> namespace for programmatically invoking
clojure.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="project-setup"><a class="link" href="#project-setup">Project setup</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_bb_edn"><a class="link" href="#_bb_edn">bb.edn</a></h3>
<div class="paragraph">
<p>Since version 0.3.1, babashka supports a local <code>bb.edn</code> file to manage a project.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paths_and_deps"><a class="link" href="#_paths_and_deps">:paths and :deps</a></h3>
<div class="paragraph">
<p>You can declare one or multiple paths and dependencies so they are automatically
added to the classpath:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:paths</span><span class="w"> </span><span class="p">[</span><span class="s">"bb"</span><span class="p">]</span><span class="w">
 </span><span class="no">:deps</span><span class="w"> </span><span class="p">{</span><span class="n">medley/medley</span><span class="w"> </span><span class="p">{</span><span class="no">:mvn/version</span><span class="w"> </span><span class="s">"1.3.0"</span><span class="p">}}}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we have a project that has a <code>deps.edn</code> and would like to reuse those deps in <code>bb.edn</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:deps</span><span class="w"> </span><span class="p">{</span><span class="n">your-org/your-project</span><span class="w"> </span><span class="p">{</span><span class="no">:local/root</span><span class="w"> </span><span class="s">"."</span><span class="p">}}}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>bb.edn</code> applies to the local project, and dependencies defined in
this files are never shared with other projects. This is typically
what you want when writing a script or tool. By contrast, <code>deps.edn</code>
is useful when creating libraries that are used by other projects.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Use a unique name to refer to your project&#8217;s <code>deps.edn</code>, the same name that
you would otherwise use when referring to your project as a dependency.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only pure Clojure libraries are supported in the <code>bb.edn</code> <code>:deps</code> map.  Java
libraries cannot be included due to the closed nature of the GraalVM classpath.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If we have a main function in a file called <code>bb/my_project/main.clj</code> like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(ns my-project.main
  (:require [medley.core :as m]))

(defn -main [&amp; _args]
  (prn (m/index-by :id [{:id 1} {:id 2}])))</pre>
</div>
</div>
<div class="paragraph">
<p>we can invoke it like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">-m</span><span class="w"> </span><span class="n">my-project.main</span><span class="w">
</span><span class="p">{</span><span class="mi">1</span><span class="w"> </span><span class="p">{</span><span class="no">:id</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="n">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">{</span><span class="no">:id</span><span class="w"> </span><span class="mi">2</span><span class="p">}}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#main-function">Invoking a main function</a> for more details on how to invoke a function from the command line.</p>
</div>
<div class="paragraph">
<p>The <code>:deps</code> entry is managed by <a href="https://github.com/borkdude/deps.clj">deps.clj</a>
and requires a <code>java</code> installation to resolve and download dependencies.</p>
</div>
</div>
<div class="sect2">
<h3 id="_min_bb_version"><a class="link" href="#_min_bb_version">:min-bb-version</a></h3>
<div class="paragraph">
<p>Since version 0.3.6, babashka supports the <code>:min-bb-version</code> where the minimal
babashka version can be declared:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:paths</span><span class="w"> </span><span class="p">[</span><span class="s">"src"</span><span class="p">]</span><span class="w">
 </span><span class="no">:deps</span><span class="w"> </span><span class="p">{</span><span class="n">medley/medley</span><span class="w"> </span><span class="p">{</span><span class="no">:mvn/version</span><span class="w"> </span><span class="s">"1.3.0"</span><span class="p">}}</span><span class="w">
 </span><span class="no">:min-bb-version</span><span class="w"> </span><span class="s">"0.3.7"</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When using an older bb version (that supports <code>:min-bb-version</code>), babashka will
print a warning:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>WARNING: this project requires babashka 0.3.7 or newer, but you have: 0.3.6</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tasks"><a class="link" href="#_tasks">:tasks</a></h3>
<div class="paragraph">
<p>Since babashka 0.4.0 the <code>bb.edn</code> file supports the <code>:tasks</code> entry which
describes tasks that you can run in the current project. The tasks feature is
similar to what people use <code>Makefile</code>, <code>Justfile</code> or <code>npm run</code> for. See <a href="#tasks">Task runner</a> for more details.</p>
</div>
</div>
<div class="sect2">
<h3 id="_script_adjacent_bb_edn"><a class="link" href="#_script_adjacent_bb_edn">Script-adjacent bb.edn</a></h3>
<div class="paragraph">
<p>Since babashka 1.3.177 a <code>bb.edn</code> file relative to the invoked file is
respected. This makes writing system-global scripts with dependencies easier.</p>
</div>
<div class="paragraph">
<p>Given a <code>bb.edn</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:deps</span><span class="w"> </span><span class="p">{</span><span class="n">medley/medley</span><span class="w"> </span><span class="p">{</span><span class="no">:mvn/version</span><span class="w"> </span><span class="s">"1.3.0"</span><span class="p">}}}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and a script <code>medley.bb</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="o">#</span><span class="n">!/usr/bin/env</span><span class="w"> </span><span class="n">bb</span><span class="w">

</span><span class="p">(</span><span class="nf">ns</span><span class="w"> </span><span class="n">medley</span><span class="w">
  </span><span class="p">(</span><span class="no">:require</span><span class="w"> </span><span class="p">[</span><span class="n">medley.core</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">medley</span><span class="p">]))</span><span class="w">

</span><span class="p">(</span><span class="nb">prn</span><span class="w"> </span><span class="p">(</span><span class="nf">medley/index-by</span><span class="w"> </span><span class="no">:id</span><span class="w"> </span><span class="p">[{</span><span class="no">:id</span><span class="w"> </span><span class="mi">1</span><span class="p">}]))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming that <code>medley.bb</code> is executable (<code>chmod +x medley.bb</code>), you can directly execute it in the current directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">~/my_project <span class="nv">$ </span>./medley.bb
<span class="o">{</span>1 <span class="o">{</span>:id 1<span class="o">}}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To execute this script from anywhere on the system, you just have to add it to the <code>PATH</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">/tmp <span class="nv">$ </span><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:~/my_project <span class="c"># ensure script is on path</span>
/tmp <span class="nv">$ </span>medley.bb <span class="c"># works, respects ~/my_project/bb.edn file with :deps</span>
<span class="o">{</span>1 <span class="o">{</span>:id 1<span class="o">}}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course you can just call your script <code>medley</code> without the <code>.bb</code> extension.</p>
</div>
<div class="sect3">
<h4 id="script-adjacent-bb-edn-windows"><a class="link" href="#script-adjacent-bb-edn-windows">Windows</a></h4>
<div class="paragraph">
<p>On Windows bash shebangs are not supported. An alternative is to create a script-adjacent <code>.bat</code> file, e.g <code>medley.bat</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">@echo off
<span class="nb">set </span><span class="nv">ARGS</span><span class="o">=</span>%<span class="k">*</span>
<span class="nb">set </span><span class="nv">SCRIPT</span><span class="o">=</span>%~dp0medley.bb
bb %SCRIPT% %ARGS%</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then add this script to your <code>%PATH%</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">C:<span class="se">\T</span>emp&gt; <span class="nb">set </span><span class="nv">PATH</span><span class="o">=</span>%PATH%<span class="p">;</span>c:<span class="se">\m</span>y_project
C:<span class="se">\T</span>emp&gt; medley
<span class="o">{</span>1 <span class="o">{</span>:id 1<span class="o">}}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tasks"><a class="link" href="#tasks">Task runner</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction"><a class="link" href="#_introduction">Introduction</a></h3>
<div class="paragraph">
<p>People often use a <code>Makefile</code>, <code>Justfile</code>, <code>npm scripts</code> or <code>lein</code> aliases in
their (clojure) projects to remember complex invocations and to create shortcuts
for them. Since version 0.4.0, babashka supports a similar feature as part of
the <code>bb.edn</code> project configuration file. For a general overview of what&#8217;s
available in <code>bb.edn</code>, go to <a href="#project-setup">Project setup</a>.</p>
</div>
<div class="paragraph">
<p>The tasks configuration lives under the <code>:tasks</code> key and can be used together
with <code>:paths</code> and <code>:deps</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:paths</span><span class="w"> </span><span class="p">[</span><span class="s">"script"</span><span class="p">]</span><span class="w">
 </span><span class="no">:deps</span><span class="w"> </span><span class="p">{</span><span class="n">medley/medley</span><span class="w"> </span><span class="p">{</span><span class="no">:mvn/version</span><span class="w"> </span><span class="s">"1.3.0"</span><span class="p">}}</span><span class="w">
 </span><span class="no">:min-bb-version</span><span class="w"> </span><span class="s">"0.4.0"</span><span class="w">
 </span><span class="no">:tasks</span><span class="w">
 </span><span class="p">{</span><span class="n">clean</span><span class="w"> </span><span class="p">(</span><span class="nf">shell</span><span class="w"> </span><span class="s">"rm -rf target"</span><span class="p">)</span><span class="w">
 </span><span class="n">...</span><span class="p">}</span><span class="w">
 </span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example we see a simple task called <code>clean</code> which invokes the
<code>shell</code> command, to remove the <code>target</code> directory. You can invoke this task from
the command line with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>bb run clean</code></pre>
</div>
</div>
<div class="paragraph">
<p>Babashka also accepts a task name without explicitly mentioning <code>run</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>bb clean</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make your tasks more cross-platform friendly, you can use the built-in
<a href="https://github.com/babashka/fs">babashka.fs</a> library. To use libraries in tasks,
use the <code>:requires</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:tasks</span><span class="w">
 </span><span class="p">{</span><span class="no">:requires</span><span class="w"> </span><span class="p">([</span><span class="n">babashka.fs</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">fs</span><span class="p">])</span><span class="w">
  </span><span class="n">clean</span><span class="w"> </span><span class="p">(</span><span class="nf">fs/delete-tree</span><span class="w"> </span><span class="s">"target"</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
 </span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Tasks accept arbitrary Clojure expressions. E.g. you can print something when executing the task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:tasks</span><span class="w">
 </span><span class="p">{</span><span class="no">:requires</span><span class="w"> </span><span class="p">([</span><span class="n">babashka.fs</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">fs</span><span class="p">])</span><span class="w">
  </span><span class="n">clean</span><span class="w"> </span><span class="p">(</span><span class="nf">do</span><span class="w"> </span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="s">"Removing target folder."</span><span class="p">)</span><span class="w">
            </span><span class="p">(</span><span class="nf">fs/delete-tree</span><span class="w"> </span><span class="s">"target"</span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w">
 </span><span class="p">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>bb clean
Removing target folder.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_talk"><a class="link" href="#_talk">Talk</a></h3>
<div class="paragraph">
<p>Go <a href="https://www.youtube.com/watch?v=u5ECoR7KT1Y&amp;ab_channel=LondonClojurians">here</a>
if you would like to watch a talk on babashka tasks.</p>
</div>
</div>
<div class="sect2">
<h3 id="_task_local_options"><a class="link" href="#_task_local_options">Task-local options</a></h3>
<div class="paragraph">
<p>Instead of naked expressions, tasks can be defined as maps with options. The
task expression should then be moved to the <code>:task</code> key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:tasks</span><span class="w">
 </span><span class="p">{</span><span class="w">
  </span><span class="n">clean</span><span class="w"> </span><span class="p">{</span><span class="no">:doc</span><span class="w"> </span><span class="s">"Removes target folder"</span><span class="w">
         </span><span class="no">:requires</span><span class="w"> </span><span class="p">([</span><span class="n">babashka.fs</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">fs</span><span class="p">])</span><span class="w">
         </span><span class="no">:task</span><span class="w"> </span><span class="p">(</span><span class="nf">fs/delete-tree</span><span class="w"> </span><span class="s">"target"</span><span class="p">)}</span><span class="w">
  </span><span class="p">}</span><span class="w">
 </span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Tasks support the <code>:doc</code> option which gives it a docstring which is printed
when invoking <code>bb tasks</code> on the command line. Other options include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>:requires</code>: task-specific namespace requires.</p>
</li>
<li>
<p><code>:extra-paths</code>: add paths to the classpath.</p>
</li>
<li>
<p><code>:extra-deps</code>: add extra dependencies to the classpath.</p>
</li>
<li>
<p><code>:enter</code>, <code>:leave</code>: override the global <code>:enter</code>/<code>:leave</code> hook.</p>
</li>
<li>
<p><code>:override-builtin</code>: override the name of a built-in babashka command.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_discoverability"><a class="link" href="#_discoverability">Discoverability</a></h3>
<div class="paragraph">
<p>When invoking <code>bb tasks</code>, babashka prints a list of all tasks found in <code>bb.edn</code> in the order of appearance. E.g. in the <a href="https://github.com/clj-kondo/clj-kondo.lsp">clj-kondo.lsp</a> project it prints:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>bb tasks
The following tasks are available:

recent-clj-kondo   Detects most recent clj-kondo version from clojars
update-project-clj Updates project.clj with most recent clj-kondo version
java1.8            Asserts that we are using java 1.8
build-server       Produces lsp server standalone jar
lsp-jar            Copies renamed jar <span class="k">for </span>upload to clj-kondo repo
upload-jar         Uploads standalone lsp server jar to clj-kondo repo
vscode-server      Copied lsp server jar to vscode extension
vscode-version     Prepares package.json with up to <span class="nb">date </span>clj-kondo version
vscode-publish     Publishes vscode extension to marketplace
ovsx-publish       Publishes vscode extension to ovsx thing
publish            The mother of all tasks: publishes everything needed <span class="k">for </span>new release</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_command_line_arguments"><a class="link" href="#_command_line_arguments">Command line arguments</a></h3>
<div class="paragraph">
<p>Command line arguments are available as <code>*command-line-args*</code>, just like in
Clojure. Since version <code>0.9.160</code>, you can use
<a href="https://github.com/babashka/cli">babashka.cli</a> in tasks via the <a href="#cli:exec">exec</a>
function to deal with command line arguments in a concise way. See the chapter on <a href="#cli">babashka CLI</a>.</p>
</div>
<div class="paragraph">
<p>Of course, you are free to parse command line arguments using the built-in
<code>tools.cli</code> library or just handle them manually.</p>
</div>
<div class="paragraph">
<p>You can re-bind <code>*command-line-args*</code> to ensure functions see a different set of
arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:tasks</span><span class="w">
 </span><span class="p">{</span><span class="no">:init</span><span class="w"> </span><span class="p">(</span><span class="nf">do</span><span class="w"> </span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">print-args</span><span class="w"> </span><span class="p">[]</span><span class="w">
              </span><span class="p">(</span><span class="nb">prn</span><span class="w"> </span><span class="p">(</span><span class="no">:name</span><span class="w"> </span><span class="p">(</span><span class="nf">current-task</span><span class="p">))</span><span class="w">
                   </span><span class="n">*command-line-args*</span><span class="p">)))</span><span class="w">
  </span><span class="n">bar</span><span class="w"> </span><span class="p">(</span><span class="nf">print-args</span><span class="p">)</span><span class="w">
  </span><span class="n">foo</span><span class="w"> </span><span class="p">(</span><span class="nf">do</span><span class="w"> </span><span class="p">(</span><span class="nf">print-args</span><span class="p">)</span><span class="w">
          </span><span class="p">(</span><span class="nb">binding</span><span class="w"> </span><span class="p">[</span><span class="n">*command-line-args*</span><span class="w"> </span><span class="p">(</span><span class="nb">next</span><span class="w"> </span><span class="n">*command-line-args*</span><span class="p">)]</span><span class="w">
            </span><span class="p">(</span><span class="nf">run</span><span class="w"> </span><span class="ss">'bar</span><span class="p">)))}}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>bb foo 1 2 3
foo <span class="o">(</span><span class="s2">"1"</span> <span class="s2">"2"</span> <span class="s2">"3"</span><span class="o">)</span>
bar <span class="o">(</span><span class="s2">"2"</span> <span class="s2">"3"</span><span class="o">)</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_terminal_tab_completion"><a class="link" href="#_terminal_tab_completion">Terminal tab-completion</a></h4>
<div class="sect4">
<h5 id="_zsh"><a class="link" href="#_zsh">zsh</a></h5>
<div class="paragraph">
<p>Add this to your <code>.zshrc</code> to get tab-complete feature on ZSH.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">_bb_tasks<span class="o">()</span> <span class="o">{</span>
    <span class="nb">local </span><span class="nv">matches</span><span class="o">=(</span><span class="sb">`</span>bb tasks |tail <span class="nt">-n</span> +3 |cut <span class="nt">-f1</span> <span class="nt">-d</span> <span class="s1">' '</span><span class="sb">`</span><span class="o">)</span>
    compadd <span class="nt">-a</span> matches
    _files <span class="c"># autocomplete filenames as well</span>
<span class="o">}</span>
compdef _bb_tasks bb</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_bash"><a class="link" href="#_bash">bash</a></h5>
<div class="paragraph">
<p>Add this to your <code>.bashrc</code> to get tab-complete feature on bash.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">_bb_tasks<span class="o">()</span> <span class="o">{</span>
    <span class="nv">COMPREPLY</span><span class="o">=(</span> <span class="si">$(</span><span class="nb">compgen</span> <span class="nt">-W</span> <span class="s2">"</span><span class="si">$(</span>bb tasks |tail <span class="nt">-n</span> +3 |cut <span class="nt">-f1</span> <span class="nt">-d</span> <span class="s1">' '</span><span class="si">)</span><span class="s2">"</span> <span class="nt">--</span> <span class="k">${</span><span class="nv">COMP_WORDS</span><span class="p">[COMP_CWORD]</span><span class="k">}</span><span class="si">)</span> <span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
<span class="c"># autocomplete filenames as well</span>
<span class="nb">complete</span> <span class="nt">-f</span> <span class="nt">-F</span> _bb_tasks bb</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_fish"><a class="link" href="#_fish">fish</a></h5>
<div class="paragraph">
<p>Add this to your <code>.config/fish/completions/bb.fish</code> to get tab-complete feature on Fish shell.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="k">function </span>__bb_complete_tasks
  <span class="k">if </span>not <span class="nb">test</span> <span class="s2">"</span><span class="nv">$__bb_tasks</span><span class="s2">"</span>
    <span class="nb">set</span> <span class="nt">-g</span> __bb_tasks <span class="o">(</span>bb tasks |tail <span class="nt">-n</span> +3 |cut <span class="nt">-f1</span> <span class="nt">-d</span> <span class="s1">' '</span><span class="o">)</span>
  end

  <span class="nb">printf</span> <span class="s2">"%s</span><span class="se">\n</span><span class="s2">"</span> <span class="nv">$__bb_tasks</span>
end

<span class="nb">complete</span> <span class="nt">-c</span> bb <span class="nt">-a</span> <span class="s2">"(__bb_complete_tasks)"</span> <span class="nt">-d</span> <span class="s1">'tasks'</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_run"><a class="link" href="#_run">Run</a></h3>
<div class="paragraph">
<p>You can execute tasks using <code>bb &lt;task-name&gt;</code>. The babashka <code>run</code> subcommand can
be used to execute with some additional options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--parallel</code>: invoke task dependencies in parallel.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:tasks</span><span class="w">
 </span><span class="p">{</span><span class="no">:init</span><span class="w"> </span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="p">(</span><span class="nf">Object.</span><span class="p">))</span><span class="w">
  </span><span class="no">:enter</span><span class="w"> </span><span class="p">(</span><span class="nb">locking</span><span class="w"> </span><span class="n">log</span><span class="w">
           </span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="p">(</span><span class="nb">str</span><span class="w"> </span><span class="p">(</span><span class="no">:name</span><span class="w"> </span><span class="p">(</span><span class="nf">current-task</span><span class="p">))</span><span class="w">
                         </span><span class="s">":"</span><span class="p">)</span><span class="w">
                    </span><span class="p">(</span><span class="nf">java.util.Date.</span><span class="p">)))</span><span class="w">
  </span><span class="n">a</span><span class="w"> </span><span class="p">(</span><span class="nf">Thread/sleep</span><span class="w"> </span><span class="mi">5000</span><span class="p">)</span><span class="w">
  </span><span class="n">b</span><span class="w"> </span><span class="p">(</span><span class="nf">Thread/sleep</span><span class="w"> </span><span class="mi">5000</span><span class="p">)</span><span class="w">
  </span><span class="n">c</span><span class="w"> </span><span class="p">{</span><span class="no">:depends</span><span class="w"> </span><span class="p">[</span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="p">]}</span><span class="w">
  </span><span class="n">d</span><span class="w"> </span><span class="p">{</span><span class="no">:task</span><span class="w"> </span><span class="p">(</span><span class="nb">time</span><span class="w"> </span><span class="p">(</span><span class="nf">run</span><span class="w"> </span><span class="ss">'c</span><span class="p">))}}}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>bb run <span class="nt">--parallel</span> d
d: <span class="c">#inst "2021-05-08T14:14:56.322-00:00"</span>
a: <span class="c">#inst "2021-05-08T14:14:56.357-00:00"</span>
b: <span class="c">#inst "2021-05-08T14:14:56.360-00:00"</span>
c: <span class="c">#inst "2021-05-08T14:15:01.366-00:00"</span>
<span class="s2">"Elapsed time: 5023.894512 msecs"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Also see <a href="#parallel">Parallel tasks</a>.</p>
</div>
</li>
<li>
<p><code>--prn</code>: print the result from the task expression:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:tasks</span><span class="w"> </span><span class="p">{</span><span class="n">sum</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">)}}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>bb run <span class="nt">--prn</span> <span class="nb">sum
</span>6</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unlike scripts, babashka tasks do not print their return value.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_hooks"><a class="link" href="#_hooks">Hooks</a></h3>
<div class="paragraph">
<p>The task runner exposes the following hooks:</p>
</div>
<div class="sect3">
<h4 id="_init"><a class="link" href="#_init">:init</a></h4>
<div class="paragraph">
<p>The <code>:init</code> is for expressions that are executed before any of the tasks are
executed. It is typically used for defining helper functions and constants:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:tasks</span><span class="w">
 </span><span class="p">{</span><span class="no">:init</span><span class="w"> </span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">env</span><span class="w"> </span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="nf">System/getenv</span><span class="w"> </span><span class="n">s</span><span class="p">))</span><span class="w">
  </span><span class="n">print-env</span><span class="w"> </span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="p">(</span><span class="nf">env</span><span class="w"> </span><span class="p">(</span><span class="nb">first</span><span class="w"> </span><span class="n">*command-line-args*</span><span class="p">)))</span><span class="w">
  </span><span class="p">}</span><span class="w">
 </span><span class="p">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ FOO</span><span class="o">=</span>1 bb print-env FOO
1</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_enter_leave"><a class="link" href="#_enter_leave">:enter, :leave</a></h4>
<div class="paragraph">
<p>The <code>:enter</code> hook is executed before each task. This is typically used to print
the name of a task, which can be obtained using the <code>current-task</code> function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:tasks</span><span class="w">
 </span><span class="p">{</span><span class="no">:init</span><span class="w"> </span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">env</span><span class="w"> </span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="nf">System/getenv</span><span class="w"> </span><span class="n">s</span><span class="p">))</span><span class="w">
  </span><span class="no">:enter</span><span class="w"> </span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="s">"Entering:"</span><span class="w"> </span><span class="p">(</span><span class="no">:name</span><span class="w"> </span><span class="p">(</span><span class="nf">current-task</span><span class="p">)))</span><span class="w">
  </span><span class="n">print-env</span><span class="w"> </span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="p">(</span><span class="nf">env</span><span class="w"> </span><span class="p">(</span><span class="nb">first</span><span class="w"> </span><span class="n">*command-line-args*</span><span class="p">)))</span><span class="w">
  </span><span class="p">}</span><span class="w">
 </span><span class="p">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ FOO</span><span class="o">=</span>1 bb print-env FOO
Entering: print-env
1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>:leave</code> hook is similar to <code>:enter</code> but is executed after each task.</p>
</div>
<div class="paragraph">
<p>Both hooks can be overriden as task-local options. Setting them to <code>nil</code> will
disable them for specific tasks (see <a href="#_task_local_options">Task-local options</a>).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tasks_api"><a class="link" href="#_tasks_api">Tasks API</a></h3>
<div class="paragraph">
<p>The <code>babashka.tasks</code> namespace exposes the following functions: <code>run</code>, <code>shell</code>,
<code>clojure</code> and <code>current-task</code>. They are implicitly imported, thus available
without a namespace prefix.</p>
</div>
<div class="sect3">
<h4 id="_run_2"><a class="link" href="#_run_2">run</a></h4>
<div class="paragraph">
<p>Tasks provide the <code>run</code> function to explicitly invoke another task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:tasks</span><span class="w">
 </span><span class="p">{</span><span class="no">:requires</span><span class="w"> </span><span class="p">([</span><span class="n">babashka.fs</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">fs</span><span class="p">])</span><span class="w">

  </span><span class="n">clean</span><span class="w"> </span><span class="p">(</span><span class="nf">do</span><span class="w">
          </span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="s">"Removing target folder."</span><span class="p">)</span><span class="w">
          </span><span class="p">(</span><span class="nf">fs/delete-tree</span><span class="w"> </span><span class="s">"target"</span><span class="p">))</span><span class="w">
  </span><span class="n">uberjar</span><span class="w"> </span><span class="p">(</span><span class="nf">do</span><span class="w">
            </span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="s">"Making uberjar"</span><span class="p">)</span><span class="w">
            </span><span class="p">(</span><span class="nf">clojure</span><span class="w"> </span><span class="s">"-X:uberjar"</span><span class="p">))</span><span class="w">
  </span><span class="n">uberjar</span><span class="no">:clean</span><span class="w"> </span><span class="p">(</span><span class="nf">do</span><span class="w"> </span><span class="p">(</span><span class="nf">run</span><span class="w"> </span><span class="ss">'clean</span><span class="p">)</span><span class="w">
                    </span><span class="p">(</span><span class="nf">run</span><span class="w"> </span><span class="ss">'uberjar</span><span class="p">))}</span><span class="w">
 </span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When running <code>bb uberjar:clean</code>, first the <code>clean</code> task is executed and the <code>uberjar</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>bb uberjar:clean
Removing target folder.
Making uberjar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>clojure</code> function in the above example executes a clojure process using <a href="https://github.com/borkdude/deps.clj">deps.clj</a>. See <a href="#tasks:clojure">clojure</a> for more info</p>
</div>
<div class="paragraph">
<p>The <code>run</code> function accepts an additional map with options:</p>
</div>
<div class="sect4">
<h5 id="_parallel"><a class="link" href="#_parallel">:parallel</a></h5>
<div class="paragraph">
<p>The <code>:parallel</code> option executes dependencies of the invoked task in parallel
(when possible). See <a href="#parallel">Parallel tasks</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_shell"><a class="link" href="#_shell">shell</a></h4>
<div class="paragraph">
<p>Both <code>shell</code> and <code>clojure</code> return a
<a href="https://github.com/babashka/babashka.process">process</a> object which returns the
<code>:exit</code> code among other info. By default these functions will throw an
exception when a non-zero exit code was returned and they will inherit the
stdin/stdout/stderr from the babashka process.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:tasks</span><span class="w">
 </span><span class="p">{</span><span class="w">
  </span><span class="n">ls</span><span class="w"> </span><span class="p">(</span><span class="nf">shell</span><span class="w"> </span><span class="s">"ls foo"</span><span class="p">)</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>bb <span class="nb">ls
ls</span>: foo: No such file or directory
Error <span class="k">while </span>executing task: <span class="nb">ls</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$?</span>
1</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can opt out of this behavior by using the <code>:continue</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:tasks</span><span class="w">
 </span><span class="p">{</span><span class="w">
  </span><span class="n">ls</span><span class="w"> </span><span class="p">(</span><span class="nf">shell</span><span class="w"> </span><span class="p">{</span><span class="no">:continue</span><span class="w"> </span><span class="n">true</span><span class="p">}</span><span class="w"> </span><span class="s">"ls foo"</span><span class="p">)</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>bb <span class="nb">ls
ls</span>: foo: No such file or directory
<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$?</span>
0</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you want to redirect output to a file instead, you can provide the <code>:out</code> option.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">shell</span><span class="w"> </span><span class="p">{</span><span class="no">:out</span><span class="w"> </span><span class="s">"file.txt"</span><span class="p">}</span><span class="w"> </span><span class="s">"echo hello"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To capture output as a string, set <code>:out</code> to <code>:string</code> and get the <code>:out</code> key
from the resulting map. In most cases, you probably want to <code>trim</code> away the
trailing newline as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">-&gt;&gt;</span><span class="w"> </span><span class="s">"echo hello"</span><span class="w"> </span><span class="p">(</span><span class="nf">shell</span><span class="w"> </span><span class="p">{</span><span class="no">:out</span><span class="w"> </span><span class="no">:string</span><span class="p">})</span><span class="w"> </span><span class="no">:out</span><span class="w"> </span><span class="n">clojure.string/trim</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To run a program in another directory, you can use the <code>:dir</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">shell</span><span class="w"> </span><span class="p">{</span><span class="no">:dir</span><span class="w"> </span><span class="s">"subproject"</span><span class="p">}</span><span class="w"> </span><span class="s">"ls"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To set environment variables with <code>shell</code> or <code>clojure</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">shell</span><span class="w"> </span><span class="p">{</span><span class="no">:extra-env</span><span class="w"> </span><span class="p">{</span><span class="s">"FOO"</span><span class="w"> </span><span class="s">"BAR"</span><span class="p">}}</span><span class="w"> </span><span class="s">"printenv FOO"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Other supported options are similar to those of
<a href="https://github.com/babashka/babashka.process"><code>babashka.process/process</code></a>.</p>
</div>
<div class="paragraph">
<p>The process is executed synchronously: i.e. babashka will wait for the process
to finish before executing the next expression. If this doesn&#8217;t fit your use
case, you can use
<a href="https://github.com/babashka/babashka.process"><code>babashka.process/process</code></a>
directly instead. These two invocations are roughly equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">babashka.process</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="no">:refer</span><span class="w"> </span><span class="p">[</span><span class="n">process</span><span class="p">]]</span><span class="w">
         </span><span class="o">'</span><span class="p">[</span><span class="n">babashka.tasks</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">tasks</span><span class="p">])</span><span class="w">

</span><span class="p">(</span><span class="nf">tasks/shell</span><span class="w"> </span><span class="p">{</span><span class="no">:dir</span><span class="w"> </span><span class="s">"subproject"</span><span class="p">}</span><span class="w"> </span><span class="s">"npm install"</span><span class="p">)</span><span class="w">

</span><span class="p">(</span><span class="nb">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">process</span><span class="w"> </span><span class="p">{</span><span class="no">:dir</span><span class="w"> </span><span class="s">"subproject"</span><span class="w"> </span><span class="no">:inherit</span><span class="w"> </span><span class="n">true</span><span class="p">}</span><span class="w"> </span><span class="s">"npm install"</span><span class="p">)</span><span class="w">
    </span><span class="p">(</span><span class="nf">p/check</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the first string argument to <code>shell</code> is tokenized (broken into multiple parts) and the trailing arguments are not:</p>
</div>
<div class="paragraph">
<p>Correct:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">shell</span><span class="w"> </span><span class="s">"npm install"</span><span class="w"> </span><span class="s">"-g"</span><span class="w"> </span><span class="s">"nbb"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Not correct (<code>-g nbb</code> within the same string):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">shell</span><span class="w"> </span><span class="s">"npm install"</span><span class="w"> </span><span class="s">"-g nbb"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the varargs signature plays well with feeding <code>*command-line-args*</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="n">shell</span><span class="w"> </span><span class="s">"npm install"</span><span class="w"> </span><span class="n">*command-line-args*</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>shell</code> does not invoke a shell but just shells out to an external program. As such, <code>shell</code> does not understand bash specific syntax.
The following does not work: <code>(shell "rm -rf target/*")</code>. To invoke a specific shell, you should do that explicitly with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">shell</span><span class="w"> </span><span class="s">"bash -c"</span><span class="w"> </span><span class="s">"rm -rf target/*"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Also see the docstring of <code>shell</code>
<a href="https://github.com/babashka/process/blob/master/API.md#shell">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="tasks:clojure"><a class="link" href="#tasks:clojure">clojure</a></h4>
<div class="paragraph">
<p>The <code>clojure</code> function starts a Clojure process using
<a href="https://github.com/borkdude/deps.clj">deps.clj</a>. The interface is exactly the
same as the clojure CLI. E.g. to evaluate an expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:tasks</span><span class="w"> </span><span class="p">{</span><span class="nb">eval</span><span class="w"> </span><span class="p">(</span><span class="nf">clojure</span><span class="w"> </span><span class="s">"-M -e '(+ 1 2 3)'"</span><span class="p">)}}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or to invoke clj-kondo as a library:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:tasks</span><span class="w"> </span><span class="p">{</span><span class="nb">eval</span><span class="w"> </span><span class="p">(</span><span class="nf">clojure</span><span class="w"> </span><span class="p">{</span><span class="no">:dir</span><span class="w"> </span><span class="s">"subproject"</span><span class="p">}</span><span class="w"> </span><span class="s">"-M:clj-kondo"</span><span class="p">)}}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>clojure</code> task function behaves similar to <code>shell</code> with respect to the exit
code, return value and supported options, except when it comes to features that
do not start a process, but only do some printing. E.g. you can capture the
classpath using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nb">with-out-str</span><span class="w"> </span><span class="p">(</span><span class="nf">clojure</span><span class="w"> </span><span class="s">"-Spath"</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>because this operation doesn&#8217;t start a process but prints to <code>*out*</code>.</p>
</div>
<div class="paragraph">
<p>To run a <code>clojure</code> task in another directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:tasks</span><span class="w"> </span><span class="p">{</span><span class="nb">eval</span><span class="w"> </span><span class="p">(</span><span class="nf">clojure</span><span class="w"> </span><span class="p">{</span><span class="no">:dir</span><span class="w"> </span><span class="s">"subproject"</span><span class="p">}</span><span class="w"> </span><span class="s">"-M:clj-kondo"</span><span class="p">)}}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="current-task"><a class="link" href="#current-task">current-task</a></h4>
<div class="paragraph">
<p>The <code>current-task</code> function returns a map representing the currently running task. This function is typically used in the <code>:enter</code> and <code>:leave</code> hooks.</p>
</div>
</div>
<div class="sect3">
<h4 id="_exec"><a class="link" href="#_exec">exec</a></h4>
<div class="paragraph">
<p>See <a href="#cli:exec">exec</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dependencies_between_tasks"><a class="link" href="#_dependencies_between_tasks">Dependencies between tasks</a></h3>
<div class="paragraph">
<p>Dependencies between tasks can be declared using <code>:depends</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:tasks</span><span class="w"> </span><span class="p">{</span><span class="no">:requires</span><span class="w"> </span><span class="p">([</span><span class="n">babashka.fs</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">fs</span><span class="p">])</span><span class="w">
         </span><span class="n">-target-dir</span><span class="w"> </span><span class="s">"target"</span><span class="w">
         </span><span class="n">-target</span><span class="w"> </span><span class="p">{</span><span class="no">:depends</span><span class="w"> </span><span class="p">[</span><span class="n">-target-dir</span><span class="p">]</span><span class="w">
                  </span><span class="no">:task</span><span class="w"> </span><span class="p">(</span><span class="nf">fs/create-dirs</span><span class="w"> </span><span class="n">-target-dir</span><span class="p">)}</span><span class="w">
         </span><span class="n">-jar-file</span><span class="w"> </span><span class="p">{</span><span class="no">:depends</span><span class="w"> </span><span class="p">[</span><span class="n">-target</span><span class="p">]</span><span class="w">
                    </span><span class="no">:task</span><span class="w"> </span><span class="s">"target/foo.jar"</span><span class="p">}</span><span class="w">

         </span><span class="n">jar</span><span class="w"> </span><span class="p">{</span><span class="no">:depends</span><span class="w"> </span><span class="p">[</span><span class="n">-target</span><span class="w"> </span><span class="n">-jar-file</span><span class="p">]</span><span class="w">
              </span><span class="no">:task</span><span class="w"> </span><span class="p">(</span><span class="nb">when</span><span class="w"> </span><span class="p">(</span><span class="nb">seq</span><span class="w"> </span><span class="p">(</span><span class="nf">fs/modified-since</span><span class="w"> </span><span class="n">-jar-file</span><span class="w">
                                             </span><span class="p">(</span><span class="nf">fs/glob</span><span class="w"> </span><span class="s">"src"</span><span class="w"> </span><span class="s">"**.clj"</span><span class="p">)))</span><span class="w">
                      </span><span class="p">(</span><span class="nf">spit</span><span class="w"> </span><span class="n">-jar-file</span><span class="w"> </span><span class="s">"test"</span><span class="p">)</span><span class="w">
                      </span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="s">"made jar!"</span><span class="p">))}</span><span class="w">
         </span><span class="n">uberjar</span><span class="w"> </span><span class="p">{</span><span class="no">:depends</span><span class="w"> </span><span class="p">[</span><span class="n">jar</span><span class="p">]</span><span class="w">
                  </span><span class="no">:task</span><span class="w"> </span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="s">"creating uberjar!"</span><span class="p">)}}}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>fs/modified-since</code> function returns a seq of all newer files compared to a
target, which can be used to prevent rebuilding artifacts when not necessary.</p>
</div>
<div class="paragraph">
<p>Alternatively you can use the <code>:init</code> hook to define vars, require namespaces,
etc.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:tasks</span><span class="w"> </span><span class="p">{</span><span class="no">:requires</span><span class="w"> </span><span class="p">([</span><span class="n">babashka.fs</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">fs</span><span class="p">])</span><span class="w">
         </span><span class="no">:init</span><span class="w"> </span><span class="p">(</span><span class="nf">do</span><span class="w"> </span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">target-dir</span><span class="w">  </span><span class="s">"target"</span><span class="p">)</span><span class="w">
                   </span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">jar-file</span><span class="w"> </span><span class="s">"target/foo.jar"</span><span class="p">))</span><span class="w">
         </span><span class="n">-target</span><span class="w"> </span><span class="p">{</span><span class="no">:task</span><span class="w"> </span><span class="p">(</span><span class="nf">fs/create-dirs</span><span class="w"> </span><span class="n">target-dir</span><span class="p">)}</span><span class="w">
         </span><span class="n">jar</span><span class="w"> </span><span class="p">{</span><span class="no">:depends</span><span class="w"> </span><span class="p">[</span><span class="n">-target</span><span class="p">]</span><span class="w">
              </span><span class="no">:task</span><span class="w"> </span><span class="p">(</span><span class="nb">when</span><span class="w"> </span><span class="p">(</span><span class="nb">seq</span><span class="w"> </span><span class="p">(</span><span class="nf">fs/modified-since</span><span class="w"> </span><span class="n">jar-file</span><span class="w">
                                             </span><span class="p">(</span><span class="nf">fs/glob</span><span class="w"> </span><span class="s">"src"</span><span class="w"> </span><span class="s">"**.clj"</span><span class="p">)))</span><span class="w">
                      </span><span class="p">(</span><span class="nf">spit</span><span class="w"> </span><span class="n">jar-file</span><span class="w"> </span><span class="s">"test"</span><span class="p">)</span><span class="w">
                      </span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="s">"made jar!"</span><span class="p">))}</span><span class="w">
         </span><span class="n">uberjar</span><span class="w"> </span><span class="p">{</span><span class="no">:depends</span><span class="w"> </span><span class="p">[</span><span class="n">jar</span><span class="p">]</span><span class="w">
                  </span><span class="no">:task</span><span class="w"> </span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="s">"creating uberjar!"</span><span class="p">)}}}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is common to define tasks that only serve as a helper to other tasks. To not
expose these tasks in the output of <code>bb tasks</code>, you can start their name with a
hyphen.</p>
</div>
</div>
<div class="sect2">
<h3 id="parallel"><a class="link" href="#parallel">Parallel tasks</a></h3>
<div class="paragraph">
<p>The <code>:parallel</code> option executes dependencies of the invoked task in parallel
(when possible). This can be used to speed up execution, but also to have
multiple tasks running in parallel for development:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">dev</span><span class="w">         </span><span class="p">{</span><span class="no">:doc</span><span class="w">  </span><span class="s">"Runs app in dev mode. Compiles cljs, less and runs JVM app in parallel."</span><span class="w">
             </span><span class="no">:task</span><span class="w"> </span><span class="p">(</span><span class="nf">run</span><span class="w"> </span><span class="ss">'-dev</span><span class="w"> </span><span class="p">{</span><span class="no">:parallel</span><span class="w"> </span><span class="n">true</span><span class="p">})}</span><span class="w">       <i class="conum" data-value="1"></i><b>(1)</b>
</span><span class="n">-dev</span><span class="w">        </span><span class="p">{</span><span class="no">:depends</span><span class="w"> </span><span class="p">[</span><span class="n">dev</span><span class="no">:cljs</span><span class="w"> </span><span class="n">dev</span><span class="no">:less</span><span class="w"> </span><span class="n">dev</span><span class="no">:backend</span><span class="p">]}</span><span class="w"> <i class="conum" data-value="2"></i><b>(2)</b>
</span><span class="n">dev</span><span class="no">:cljs</span><span class="w">    </span><span class="p">{</span><span class="no">:doc</span><span class="w">  </span><span class="s">"Runs front-end compilation"</span><span class="w">
             </span><span class="no">:task</span><span class="w"> </span><span class="p">(</span><span class="nf">clojure</span><span class="w"> </span><span class="s">"-M:frontend:cljs/dev"</span><span class="p">)}</span><span class="w">
</span><span class="n">dev</span><span class="no">:less</span><span class="w">    </span><span class="p">{</span><span class="no">:doc</span><span class="w">  </span><span class="s">"Compiles less"</span><span class="w">
             </span><span class="no">:task</span><span class="w"> </span><span class="p">(</span><span class="nf">clojure</span><span class="w"> </span><span class="s">"-M:frontend:less/dev"</span><span class="p">)}</span><span class="w">
</span><span class="n">dev</span><span class="no">:backend</span><span class="w"> </span><span class="p">{</span><span class="no">:doc</span><span class="w">  </span><span class="s">"Runs backend in dev mode"</span><span class="w">
             </span><span class="no">:task</span><span class="w"> </span><span class="p">(</span><span class="nf">clojure</span><span class="w"> </span><span class="p">(</span><span class="nb">str</span><span class="w"> </span><span class="s">"-A:backend:backend/dev:"</span><span class="w"> </span><span class="n">platform-alias</span><span class="p">)</span><span class="w">
                            </span><span class="s">"-X"</span><span class="w"> </span><span class="s">"dre.standalone/start"</span><span class="p">)}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>dev</code> task invokes the (private) <code>-dev</code> task in parallel</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>-dev</code> task depends on three other tasks which are executed simultaneously.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_invoking_a_main_function"><a class="link" href="#_invoking_a_main_function">Invoking a main function</a></h3>
<div class="paragraph">
<p>Invoking a main function can be done by providing a fully qualified
symbol:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:tasks</span><span class="w">
  </span><span class="p">{</span><span class="n">foo-bar</span><span class="w"> </span><span class="n">foo.bar/-main</span><span class="p">}}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use any fully qualified symbol, not just ones that end in <code>-main</code> (so e.g.
<code>foo.bar/baz</code> is fine). You can also have multiple main functions in one namespace.</p>
</div>
<div class="paragraph">
<p>The namespace <code>foo.bar</code> will be automatically required and the function
will be invoked with <code>*command-line-args*</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">foo-bar</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_repl_2"><a class="link" href="#_repl_2">REPL</a></h3>
<div class="paragraph">
<p>To get a REPL within a task, you can use <code>clojure.main/repl</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:tasks</span><span class="w"> </span><span class="p">{</span><span class="n">repl</span><span class="w"> </span><span class="p">(</span><span class="nf">clojure.main/repl</span><span class="p">)}}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can use <code>babashka.tasks/run</code> to invoke a task from a REPL.</p>
</div>
<div class="paragraph">
<p>For REPL- and linting-friendliness, it&#8217;s recommended to move task code longer
than a couple of lines to a <code>.clj</code> or <code>.bb</code> file.</p>
</div>
</div>
<div class="sect2">
<h3 id="_real_world_examples"><a class="link" href="#_real_world_examples">Real world examples</a></h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/borkdude/antq/blob/bb-run/bb.edn">antq</a></p>
</li>
<li>
<p><a href="https://github.com/borkdude/mach/blob/bb-run/examples/app/bb.edn">mach</a></p>
</li>
<li>
<p><a href="https://gist.github.com/borkdude/35bc0a20bd4c112dec2c5645f67250e3">bb.edn
at Doctor Evidence</a></p>
</li>
<li>
<p><a href="https://github.com/clj-kondo/clj-kondo.lsp/blob/master/bb.edn">clj-kondo.lsp</a></p>
</li>
<li>
<p><a href="https://github.com/wilkerlucio/pathom-viz/blob/master/bb.edn">pathom</a></p>
</li>
<li>
<p><a href="https://github.com/redstarssystems/rssyslib/blob/develop/bb.edn">rssyslib</a></p>
</li>
<li>
<p><a href="https://github.com/clj-commons/rewrite-clj/blob/main/bb.edn">rewrite-clj</a></p>
</li>
<li>
<p><a href="https://gist.github.com/delyada/9f50fa7466358e55f27e4e6b4314242f" class="bare">https://gist.github.com/delyada/9f50fa7466358e55f27e4e6b4314242f</a></p>
</li>
<li>
<p><a href="https://github.com/rwstauner/jirazzz/blob/main/bb.edn">jirazzz</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_naming"><a class="link" href="#_naming">Naming</a></h3>
<div class="sect3">
<h4 id="_valid_names"><a class="link" href="#_valid_names">Valid names</a></h4>
<div class="paragraph">
<p>When running a task, babashka assembles a small program which defines vars
bound to the return values of tasks. This brings the limitation that you can
only choose names for your tasks that are valid as var names. You can&#8217;t name
your task <code>foo/bar</code> for this reason. If you want to use delimiters to indicate
some sort of grouping, you can do it like <code>foo-bar</code>, <code>foo:bar</code> or <code>foo_bar</code>.</p>
</div>
<div class="paragraph">
<p>Names starting with a <code>-</code> are considered "private" and not listed in the
<code>bb tasks</code> output.</p>
</div>
</div>
<div class="sect3">
<h4 id="_conflicting_file_task_subcommand_names"><a class="link" href="#_conflicting_file_task_subcommand_names">Conflicting file / task / subcommand names</a></h4>
<div class="paragraph">
<p><code>bb &lt;option&gt;</code> is resolved in the order of file &gt; task &gt; subcommand.</p>
</div>
<div class="paragraph">
<p>Escape hatches in case of conflicts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>execute relative file as <code>bb ./foo</code></p>
</li>
<li>
<p>execute task as <code>bb run foo</code></p>
</li>
<li>
<p>execute subcommand as <code>bb --foo</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When choosing a task name that overrides a babashka builtin subcommand, you have
to provide the <code>:override-builtin</code> option to get rid of the warning that appears
when running babashka:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">-Sdeps</span><span class="w"> </span><span class="o">'</span><span class="p">{</span><span class="no">:tasks</span><span class="w"> </span><span class="p">{</span><span class="n">help</span><span class="w"> </span><span class="p">{</span><span class="no">:task</span><span class="w"> </span><span class="p">(</span><span class="nb">prn</span><span class="w"> </span><span class="no">:help</span><span class="p">)}}}</span><span class="o">'</span><span class="w"> </span><span class="n">help</span><span class="w">
</span><span class="p">[</span><span class="n">babashka</span><span class="p">]</span><span class="w"> </span><span class="n">WARNING</span><span class="err">:</span><span class="w"> </span><span class="n">task</span><span class="p">(</span><span class="nf">s</span><span class="p">)</span><span class="w"> </span><span class="ss">'help</span><span class="o">'</span><span class="w"> </span><span class="n">override</span><span class="w"> </span><span class="n">built-in</span><span class="w"> </span><span class="n">command</span><span class="p">(</span><span class="nf">s</span><span class="p">)</span><span class="nb">.</span><span class="w">
</span><span class="no">:help</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">-Sdeps</span><span class="w"> </span><span class="o">'</span><span class="p">{</span><span class="no">:tasks</span><span class="w"> </span><span class="p">{</span><span class="n">help</span><span class="w"> </span><span class="p">{</span><span class="no">:task</span><span class="w"> </span><span class="p">(</span><span class="nb">prn</span><span class="w"> </span><span class="no">:help</span><span class="p">)</span><span class="w"> </span><span class="no">:override-builtin</span><span class="w"> </span><span class="n">true</span><span class="p">}}}</span><span class="o">'</span><span class="w"> </span><span class="n">help</span><span class="w">
</span><span class="no">:help</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_conflicting_task_and_clojure_core_var_names"><a class="link" href="#_conflicting_task_and_clojure_core_var_names">Conflicting task and clojure.core var names</a></h4>
<div class="paragraph">
<p>You can name a task similar to a core var, let&#8217;s say: <code>format</code>. If you want to
refer to the core var, it is recommended to use the fully qualified
<code>clojure.core/format</code> in that case, to avoid conflicts in <code>:enter</code> and <code>:leave</code>
expressions and when using the <code>format</code> task as a dependency.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syntax"><a class="link" href="#_syntax">Syntax</a></h3>
<div class="paragraph">
<p>Because <code>bb.edn</code> is an EDN file, you cannot use all of Clojure&#8217;s syntax in
expressions. Most notably:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You cannot use <code>#(foo %)</code>, but you can use <code>(fn [x] (foo x))</code></p>
</li>
<li>
<p>You cannot use <code>@(foo)</code> but you can use <code>(deref foo)</code></p>
</li>
<li>
<p>You cannot use <code>#"re"</code> but you can use <code>(re-pattern "re")</code></p>
</li>
<li>
<p>Single quotes are accidentally supported in some places, but are better
avoided: <code>{:task '(foo)}</code> does not work, but <code>{:task (quote (foo))</code> does
work. When requiring namespaces, use the <code>:requires</code> feature in favor of doing
it manually using <code>(require '[foo])</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cli"><a class="link" href="#cli">Babashka CLI</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In version <code>0.9.160</code> of babashka, the <a href="https://github.com/babashka/cli">babashka
CLI</a> added as a built-in library together with task integration.</p>
</div>
<div class="sect2">
<h3 id="_x"><a class="link" href="#_x">-x</a></h3>
<div class="paragraph">
<p>For invoking functions from the command line, you can use the new <code>-x</code>
flag (a pun to Clojures <code>-X</code> of course!):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">bb</span><span class="w"> </span><span class="n">-x</span><span class="w"> </span><span class="n">clojure.core/prn</span><span class="w"> </span><span class="n">--hello</span><span class="w"> </span><span class="n">there</span><span class="w">
</span><span class="p">{</span><span class="no">:hello</span><span class="w"> </span><span class="s">"there"</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What we see in the above snippet is that a map <code>{:hello "there"}</code> is
constructed by babashka CLI and then fed to the <code>prn</code> function.
After that the result is printed to the console.</p>
</div>
<div class="paragraph">
<p>What if we want to influence how things are parsed by babashka CLI and
provide some defaults? This can be done using metadata. Lets create a
<code>bb.edn</code> and make a file available on the classpath:</p>
</div>
<div class="paragraph">
<p><code>bb.edn</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:paths</span><span class="w"> </span><span class="p">[</span><span class="s">"."</span><span class="p">]}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>tasks.clj</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">ns</span><span class="w"> </span><span class="n">tasks</span><span class="w">
  </span><span class="p">{</span><span class="no">:org.babashka/cli</span><span class="w"> </span><span class="p">{</span><span class="no">:exec-args</span><span class="w"> </span><span class="p">{</span><span class="no">:ns-data</span><span class="w"> </span><span class="mi">1</span><span class="p">}}})</span><span class="w">

</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">my-function</span><span class="w">
  </span><span class="p">{</span><span class="no">:org.babashka/cli</span><span class="w"> </span><span class="p">{</span><span class="no">:exec-args</span><span class="w"> </span><span class="p">{</span><span class="no">:fn-data</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="w">
                      </span><span class="no">:coerce</span><span class="w"> </span><span class="p">{</span><span class="no">:num</span><span class="w"> </span><span class="p">[</span><span class="no">:int</span><span class="p">]}</span><span class="w">
                      </span><span class="no">:alias</span><span class="w"> </span><span class="p">{</span><span class="no">:n</span><span class="w"> </span><span class="no">:num</span><span class="p">}}}</span><span class="w">
  </span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="w"> </span><span class="n">m</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now lets invoke:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">--prn</span><span class="w"> </span><span class="n">-x</span><span class="w"> </span><span class="n">tasks/my-function</span><span class="w"> </span><span class="n">-n</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span><span class="p">{</span><span class="no">:ns-data</span><span class="w"> </span><span class="mi">1</span><span class="n">,</span><span class="w"> </span><span class="no">:fn-data</span><span class="w"> </span><span class="mi">1</span><span class="n">,</span><span class="w"> </span><span class="no">:num</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="p">]}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the namespace options are merged with the function
options. Defaults can be provided with <code>:exec-args</code>, like youre used
to from the clojure CLI.</p>
</div>
</div>
<div class="sect2">
<h3 id="cli:exec"><a class="link" href="#cli:exec">exec</a></h3>
<div class="paragraph">
<p>What about task integration? Lets adapt our <code>bb.edn</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:paths</span><span class="w"> </span><span class="p">[</span><span class="s">"."</span><span class="p">]</span><span class="w">
 </span><span class="no">:tasks</span><span class="w"> </span><span class="p">{</span><span class="n">doit</span><span class="w"> </span><span class="p">{</span><span class="no">:task</span><span class="w"> </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">x</span><span class="w"> </span><span class="p">(</span><span class="nf">exec</span><span class="w"> </span><span class="ss">'tasks/my-function</span><span class="p">)]</span><span class="w">
                       </span><span class="p">(</span><span class="nb">prn</span><span class="w"> </span><span class="no">:x</span><span class="w"> </span><span class="n">x</span><span class="p">))</span><span class="w">
               </span><span class="no">:exec-args</span><span class="w"> </span><span class="p">{</span><span class="no">:task-data</span><span class="w"> </span><span class="mi">1234</span><span class="p">}}</span><span class="w">
         </span><span class="p">}}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and invoke the task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">doit</span><span class="w"> </span><span class="n">--cli-option</span><span class="w"> </span><span class="no">:yeah</span><span class="w"> </span><span class="n">-n</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span><span class="no">:x</span><span class="w"> </span><span class="p">{</span><span class="no">:ns-data</span><span class="w"> </span><span class="mi">1</span><span class="n">,</span><span class="w"> </span><span class="no">:fn-data</span><span class="w"> </span><span class="mi">1</span><span class="n">,</span><span class="w"> </span><span class="no">:task-data</span><span class="w"> </span><span class="mi">1234</span><span class="n">,</span><span class="w"> </span><span class="no">:cli-option</span><span class="w"> </span><span class="no">:yeah,</span><span class="w"> </span><span class="no">:num</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">]}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see it works similar to <code>-x</code>, but you can provide another
set of defaults on the task level with <code>:exec-args</code>. Executing a
function through babashka CLI is done using the <code>babashka.task/exec</code>
function, available by default in tasks.</p>
</div>
<div class="paragraph">
<p>To add <code>:exec-args</code> that should be evaluated you can pass an extra map to <code>exec</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:paths</span><span class="w"> </span><span class="p">[</span><span class="s">"."</span><span class="p">]</span><span class="w">
 </span><span class="no">:tasks</span><span class="w"> </span><span class="p">{</span><span class="n">doit</span><span class="w"> </span><span class="p">{</span><span class="no">:task</span><span class="w"> </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">x</span><span class="w"> </span><span class="p">(</span><span class="nf">exec</span><span class="w"> </span><span class="ss">'tasks/my-function</span><span class="w"> </span><span class="p">{</span><span class="no">:exec-args</span><span class="w"> </span><span class="p">{</span><span class="no">:foo</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">)}})]</span><span class="w">
                       </span><span class="p">(</span><span class="nb">prn</span><span class="w"> </span><span class="no">:x</span><span class="w"> </span><span class="n">x</span><span class="p">))</span><span class="w">
               </span><span class="no">:exec-args</span><span class="w"> </span><span class="p">{</span><span class="no">:task-data</span><span class="w"> </span><span class="mi">1234</span><span class="p">}}</span><span class="w">
         </span><span class="p">}}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">doit</span><span class="w"> </span><span class="n">--cli-option</span><span class="w"> </span><span class="no">:yeah</span><span class="w"> </span><span class="n">-n</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span><span class="no">:x</span><span class="w"> </span><span class="p">{</span><span class="no">:ns-data</span><span class="w"> </span><span class="mi">1</span><span class="n">,</span><span class="w"> </span><span class="no">:fn-data</span><span class="w"> </span><span class="mi">1</span><span class="n">,</span><span class="w"> </span><span class="no">:task-data</span><span class="w"> </span><span class="mi">1234</span><span class="n">,</span><span class="w"> </span><span class="no">:cli-option</span><span class="w"> </span><span class="no">:yeah,</span><span class="w"> </span><span class="no">:num</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="no">:foo</span><span class="w"> </span><span class="mi">6</span><span class="p">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="libraries"><a class="link" href="#libraries">Libraries</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="built-in-namespaces"><a class="link" href="#built-in-namespaces">Built-in namespaces</a></h3>
<div class="paragraph">
<p>In addition to <code>clojure.core</code>, the following libraries / namespaces are available in babashka.
Some are available through pre-defined aliases in the <code>user</code> namespace,
which can be handy for one-liners. If not all vars are available, they
are enumerated explicitly. If some important var is missing, an issue or
PR is welcome.</p>
</div>
<div class="paragraph">
<p>From Clojure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>clojure.core</code></p>
</li>
<li>
<p><code>clojure.core.protocols</code>: <code>Datafiable</code>, <code>Navigable</code></p>
</li>
<li>
<p><code>clojure.data</code></p>
</li>
<li>
<p><code>clojure.datafy</code></p>
</li>
<li>
<p><code>clojure.edn</code> aliased as <code>edn</code></p>
</li>
<li>
<p><code>clojure.math</code></p>
</li>
<li>
<p><code>clojure.java.browse</code></p>
</li>
<li>
<p><code>clojure.java.io</code> aliased as <code>io</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>as-relative-path</code>, <code>as-url</code>, <code>copy</code>, <code>delete-file</code>, <code>file</code>,
<code>input-stream</code>, <code>make-parents</code>, <code>output-stream</code>, <code>reader</code>, <code>resource</code>,
<code>writer</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>clojure.java.shell</code> aliased as <code>shell</code></p>
</li>
<li>
<p><code>clojure.main</code>: <code>demunge</code>, <code>repl</code>, <code>repl-requires</code></p>
</li>
<li>
<p><code>clojure.pprint</code>: <code>pprint</code>, <code>cl-format</code></p>
</li>
<li>
<p><code>clojure.set</code> aliased as <code>set</code></p>
</li>
<li>
<p><code>clojure.string</code> aliased as <code>str</code></p>
</li>
<li>
<p><code>clojure.stacktrace</code></p>
</li>
<li>
<p><code>clojure.test</code></p>
</li>
<li>
<p><code>clojure.walk</code></p>
</li>
<li>
<p><code>clojure.zip</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additional libraries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/babashka/cli"><code>babashka.cli</code></a>: CLI arg parsing</p>
</li>
<li>
<p><a href="https://github.com/babashka/http-client"><code>babashka.http-client</code></a>: making HTTP requests</p>
</li>
<li>
<p><a href="https://github.com/babashka/process"><code>babashka.process</code></a>: shelling out to external processes</p>
</li>
<li>
<p><a href="https://github.com/babashka/fs"><code>babashka.fs</code></a>: file system manipulation</p>
</li>
<li>
<p><a href="https://github.com/nrepl/bencode"><code>bencode.core</code></a> aliased as <code>bencode</code>:
<code>read-bencode</code>, <code>write-bencode</code></p>
</li>
<li>
<p><a href="https://github.com/dakrone/cheshire"><code>cheshire.core</code></a> aliased as <code>json</code>: dealing with JSON</p>
</li>
<li>
<p><a href="https://clojure.github.io/core.async/"><code>clojure.core.async</code></a> aliased as
<code>async</code>.</p>
</li>
<li>
<p><a href="https://github.com/clojure/data.csv"><code>clojure.data.csv</code></a> aliased as
<code>csv</code></p>
</li>
<li>
<p><a href="https://github.com/clojure/data.xml"><code>clojure.data.xml</code></a> aliased as
<code>xml</code></p>
</li>
<li>
<p><a href="https://github.com/clojure/tools.cli"><code>clojure.tools.cli</code></a> aliased as
<code>tools.cli</code></p>
</li>
<li>
<p><a href="https://github.com/clj-commons/clj-yaml"><code>clj-yaml.core</code></a> alias as
<code>yaml</code></p>
</li>
<li>
<p><a href="https://github.com/cognitect/transit-clj"><code>cognitect.transit</code></a> aliased
as <code>transit</code></p>
</li>
<li>
<p><a href="https://github.com/http-kit/http-kit"><code>org.httpkit.client</code></a></p>
</li>
<li>
<p><a href="https://github.com/http-kit/http-kit"><code>org.httpkit.server</code></a></p>
</li>
<li>
<p><a href="https://github.com/clojure/core.match"><code>clojure.core.match</code></a></p>
</li>
<li>
<p><a href="https://github.com/weavejester/hiccup/"><code>hiccup.core</code></a> and <code>hiccup2.core</code></p>
</li>
<li>
<p><a href="https://github.com/clojure/test.check"><code>clojure.test.check</code></a>:</p>
<div class="ulist">
<ul>
<li>
<p><code>clojure.test.check</code></p>
</li>
<li>
<p><code>clojure.test.check.generators</code></p>
</li>
<li>
<p><code>clojure.test.check.properties</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/clj-commons/rewrite-clj"><code>rewrite-clj</code></a>:</p>
<div class="ulist">
<ul>
<li>
<p><code>rewrite-clj.parser</code></p>
</li>
<li>
<p><code>rewrite-clj.node</code></p>
</li>
<li>
<p><code>rewrite-clj.zip</code></p>
</li>
<li>
<p><code>rewrite-clj.paredit</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/yogthos/Selmer"><code>Selmer</code></a>:</p>
<div class="ulist">
<ul>
<li>
<p><code>selmer.parser</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/clojure/tools.logging"><code>clojure.tools.logging</code></a></p>
</li>
<li>
<p><a href="https://github.com/ptaoussanis/timbre"><code>timbre</code></a>: logging</p>
</li>
<li>
<p><a href="https://github.com/borkdude/edamame"><code>edamame</code></a>: Clojure parser</p>
</li>
<li>
<p><a href="https://github.com/clojure/core.rrb-vector"><code>core.rrb-vector</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Check out the <a href="https://babashka.org/toolbox/">babashka toolbox</a> and
<a href="https://github.com/borkdude/babashka/blob/master/doc/projects.md">projects</a> page
for libraries that are not built-in, but which you can load as an external
dependency in <a href="https://book.babashka.org/#_bb_edn"><code>bb.edn</code></a>.</p>
</div>
<div class="paragraph">
<p>See the
<a href="https://github.com/borkdude/babashka/blob/master/doc/build.md">build</a>
page for built-in libraries that can be enabled via feature flags, if
you want to compile babashka yourself.</p>
</div>
<div class="paragraph">
<p>A selection of Java classes are available, see
<a href="https://github.com/babashka/babashka/blob/master/src/babashka/impl/classes.clj"><code>babashka/impl/classes.clj</code></a>
in babashka&#8217;s git repo.</p>
</div>
</div>
<div class="sect2">
<h3 id="_babashka_namespaces"><a class="link" href="#_babashka_namespaces">Babashka namespaces</a></h3>
<div class="sect3">
<h4 id="babashka_classpath"><a class="link" href="#babashka_classpath">babashka.classpath</a></h4>
<div class="paragraph">
<p>Available functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>add-classpath</code></p>
</li>
<li>
<p><code>get-classpath</code></p>
</li>
<li>
<p><code>split-classpath</code></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_add_classpath"><a class="link" href="#_add_classpath">add-classpath</a></h5>
<div class="paragraph">
<p>The function <code>add-classpath</code> which can be used to add to the classpath
dynamically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">babashka.classpath</span><span class="w"> </span><span class="no">:refer</span><span class="w"> </span><span class="p">[</span><span class="n">add-classpath</span><span class="p">]]</span><span class="w">
         </span><span class="o">'</span><span class="p">[</span><span class="n">clojure.java.shell</span><span class="w"> </span><span class="no">:refer</span><span class="w"> </span><span class="p">[</span><span class="n">sh</span><span class="p">]]</span><span class="w">
         </span><span class="o">'</span><span class="p">[</span><span class="n">clojure.string</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="nb">str</span><span class="p">])</span><span class="w">

</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">medley-dep</span><span class="w"> </span><span class="o">'</span><span class="p">{</span><span class="no">:deps</span><span class="w"> </span><span class="p">{</span><span class="n">medley</span><span class="w"> </span><span class="p">{</span><span class="no">:git/url</span><span class="w"> </span><span class="s">"https://github.com/borkdude/medley"</span><span class="w">
                                 </span><span class="no">:sha</span><span class="w"> </span><span class="s">"91adfb5da33f8d23f75f0894da1defe567a625c0"</span><span class="p">}}})</span><span class="w">
</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">cp</span><span class="w"> </span><span class="p">(</span><span class="nb">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">sh</span><span class="w"> </span><span class="s">"clojure"</span><span class="w"> </span><span class="s">"-Spath"</span><span class="w"> </span><span class="s">"-Sdeps"</span><span class="w"> </span><span class="p">(</span><span class="nb">str</span><span class="w"> </span><span class="n">medley-dep</span><span class="p">))</span><span class="w"> </span><span class="no">:out</span><span class="w"> </span><span class="n">str/trim</span><span class="p">))</span><span class="w">
</span><span class="p">(</span><span class="nf">add-classpath</span><span class="w"> </span><span class="n">cp</span><span class="p">)</span><span class="w">
</span><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">medley.core</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">m</span><span class="p">])</span><span class="w">
</span><span class="p">(</span><span class="nf">m/index-by</span><span class="w"> </span><span class="no">:id</span><span class="w"> </span><span class="p">[{</span><span class="no">:id</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="no">:id</span><span class="w"> </span><span class="mi">2</span><span class="p">}])</span><span class="w"> </span><span class="c1">;;=&gt; {1 {:id 1}, 2 {:id 2}}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_get_classpath"><a class="link" href="#_get_classpath">get-classpath</a></h5>
<div class="paragraph">
<p>The function <code>get-classpath</code> returns the classpath as set by <code>--classpath</code>,
<code>BABASHKA_CLASSPATH</code> and <code>add-classpath</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_split_classpath"><a class="link" href="#_split_classpath">split-classpath</a></h5>
<div class="paragraph">
<p>Given a classpath, returns a seq of strings as the result of splitting the
classpath by the platform specific path separatator.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="babashkadeps"><a class="link" href="#babashkadeps">babashka.deps</a></h4>
<div class="paragraph">
<p>Available functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>add-deps</code></p>
</li>
<li>
<p><code>clojure</code></p>
</li>
<li>
<p><code>merge-deps</code></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_add_deps"><a class="link" href="#_add_deps">add-deps</a></h5>
<div class="paragraph">
<p>The function <code>add-deps</code> takes a deps edn map like <code>{:deps {medley/medley
{:mvn/version "1.3.0"}}}</code>, resolves it using
<a href="https://github.com/borkdude/deps.clj">deps.clj</a> and then adds to the babashka
classpath accordingly.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">babashka.deps</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">deps</span><span class="p">])</span><span class="w">

</span><span class="p">(</span><span class="nf">deps/add-deps</span><span class="w"> </span><span class="o">'</span><span class="p">{</span><span class="no">:deps</span><span class="w"> </span><span class="p">{</span><span class="n">medley/medley</span><span class="w"> </span><span class="p">{</span><span class="no">:mvn/version</span><span class="w"> </span><span class="s">"1.3.0"</span><span class="p">}}})</span><span class="w">

</span><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">medley.core</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">m</span><span class="p">])</span><span class="w">
</span><span class="p">(</span><span class="nf">m/index-by</span><span class="w"> </span><span class="no">:id</span><span class="w"> </span><span class="p">[{</span><span class="no">:id</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="no">:id</span><span class="w"> </span><span class="mi">2</span><span class="p">}])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Optionally, <code>add-deps</code> takes a second arg with options. Currently the only
option is <code>:aliases</code> which will affect how deps are resolved:</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">deps/add-deps</span><span class="w"> </span><span class="o">'</span><span class="p">{</span><span class="no">:aliases</span><span class="w"> </span><span class="p">{</span><span class="no">:medley</span><span class="w"> </span><span class="p">{</span><span class="no">:extra-deps</span><span class="w"> </span><span class="p">{</span><span class="n">medley/medley</span><span class="w"> </span><span class="p">{</span><span class="no">:mvn/version</span><span class="w"> </span><span class="s">"1.3.0"</span><span class="p">}}}}}</span><span class="w">
               </span><span class="p">{</span><span class="no">:aliases</span><span class="w"> </span><span class="p">[</span><span class="no">:medley</span><span class="p">]})</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_clojure"><a class="link" href="#_clojure">clojure</a></h5>
<div class="paragraph">
<p>The function <code>clojure</code> takes a sequential collection of arguments, similar to
the clojure CLI. The arguments are then passed to
<a href="https://github.com/borkdude/deps.clj">deps.clj</a>. The <code>clojure</code> function returns
<code>nil</code> and prints to <code>*out*</code> for commands like <code>-Stree</code>, and <code>-Spath</code>. For <code>-M</code>,
<code>-X</code> and <code>-A</code> it invokes <code>java</code> with <code>babashka.process/process</code> (see
<a href="#babashkaprocess">babashka.process</a>) and returns the associated record. For
more details, read the docstring with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">clojure.repl</span><span class="w"> </span><span class="no">:refer</span><span class="w"> </span><span class="p">[</span><span class="nb">doc</span><span class="p">]])</span><span class="w">
</span><span class="p">(</span><span class="nb">doc</span><span class="w"> </span><span class="n">babashka.deps/clojure</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="paragraph">
<p>The following script passes through command line arguments to clojure, while
adding the medley dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">babashka.deps</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">deps</span><span class="p">])</span><span class="w">

</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">deps</span><span class="w"> </span><span class="o">'</span><span class="p">{</span><span class="no">:deps</span><span class="w"> </span><span class="p">{</span><span class="n">medley/medley</span><span class="w"> </span><span class="p">{</span><span class="no">:mvn/version</span><span class="w"> </span><span class="s">"1.3.0"</span><span class="p">}}})</span><span class="w">
</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">clojure-args</span><span class="w"> </span><span class="p">(</span><span class="nb">list*</span><span class="w"> </span><span class="s">"-Sdeps"</span><span class="w"> </span><span class="n">deps</span><span class="w">  </span><span class="n">*command-line-args*</span><span class="p">))</span><span class="w">

</span><span class="p">(</span><span class="nb">if-let</span><span class="w"> </span><span class="p">[</span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="nf">deps/clojure</span><span class="w"> </span><span class="n">clojure-args</span><span class="p">)]</span><span class="w">
  </span><span class="p">(</span><span class="nb">-&gt;</span><span class="w"> </span><span class="o">@</span><span class="n">proc</span><span class="w"> </span><span class="no">:exit</span><span class="w"> </span><span class="p">(</span><span class="nf">System/exit</span><span class="p">))</span><span class="w">
  </span><span class="p">(</span><span class="nf">System/exit</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="babashkawait"><a class="link" href="#babashkawait">babashka.wait</a></h4>
<div class="paragraph">
<p>Contains the functions: <code>wait-for-port</code> and <code>wait-for-path</code>.</p>
</div>
<div class="paragraph">
<p>Usage of <code>wait-for-port</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">wait/wait-for-port</span><span class="w"> </span><span class="s">"localhost"</span><span class="w"> </span><span class="mi">8080</span><span class="p">)</span><span class="w">
</span><span class="p">(</span><span class="nf">wait/wait-for-port</span><span class="w"> </span><span class="s">"localhost"</span><span class="w"> </span><span class="mi">8080</span><span class="w"> </span><span class="p">{</span><span class="no">:timeout</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="no">:pause</span><span class="w"> </span><span class="mi">1000</span><span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Waits for TCP connection to be available on host and port. Options map
supports <code>:timeout</code> and <code>:pause</code>. If <code>:timeout</code> is provided and reached,
<code>:default</code>'s value (if any) is returned. The <code>:pause</code> option determines
the time waited between retries.</p>
</div>
<div class="paragraph">
<p>Usage of <code>wait-for-path</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">wait/wait-for-path</span><span class="w"> </span><span class="s">"/tmp/wait-path-test"</span><span class="p">)</span><span class="w">
</span><span class="p">(</span><span class="nf">wait/wait-for-path</span><span class="w"> </span><span class="s">"/tmp/wait-path-test"</span><span class="w"> </span><span class="p">{</span><span class="no">:timeout</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="no">:pause</span><span class="w"> </span><span class="mi">1000</span><span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Waits for file path to be available. Options map supports <code>:default</code>,
<code>:timeout</code> and <code>:pause</code>. If <code>:timeout</code> is provided and reached,
<code>:default</code>'s value (if any) is returned. The <code>:pause</code> option determines
the time waited between retries.</p>
</div>
<div class="paragraph">
<p>The namespace <code>babashka.wait</code> is aliased as <code>wait</code> in the <code>user</code>
namespace.</p>
</div>
</div>
<div class="sect3">
<h4 id="babashkasignal"><a class="link" href="#babashkasignal">babashka.signal</a></h4>
<div class="paragraph">
<p>Contains the function <code>signal/pipe-signal-received?</code>. Usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">signal/pipe-signal-received?</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Returns true if <code>PIPE</code> signal was received. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>bb <span class="nt">-e</span> <span class="s1">'((fn [x] (println x) (when (not (signal/pipe-signal-received?)) (recur (inc x)))) 0)'</span> | <span class="nb">head</span> <span class="nt">-n2</span>
1
2</code></pre>
</div>
</div>
<div class="paragraph">
<p>The namespace <code>babashka.signal</code> is aliased as <code>signal</code> in the <code>user</code>
namespace.</p>
</div>
</div>
<div class="sect3">
<h4 id="babashkahttpclient"><a class="link" href="#babashkahttpclient">babashka.http-client</a></h4>
<div class="paragraph">
<p>The <code>babashka.http-client</code> library for making HTTP requests. See
<a href="https://github.com/babashka/http-client">babashka.http-client</a> for how to use it.</p>
</div>
</div>
<div class="sect3">
<h4 id="babashkaprocess"><a class="link" href="#babashkaprocess">babashka.process</a></h4>
<div class="paragraph">
<p>The <code>babashka.process</code> library. See the
<a href="https://github.com/babashka/process">process</a> repo for API docs.</p>
</div>
</div>
<div class="sect3">
<h4 id="babashkafs"><a class="link" href="#babashkafs">babashka.fs</a></h4>
<div class="paragraph">
<p>The <code>babashka.fs</code> library offers file system utilities. See the
<a href="https://github.com/babashka/fs">fs</a> repo for API docs.</p>
</div>
</div>
<div class="sect3">
<h4 id="babashkacli"><a class="link" href="#babashkacli">babashka.cli</a></h4>
<div class="paragraph">
<p>The <code>babashka.cli</code> library allows you to turn functions into CLIs. See the
<a href="https://github.com/babashka/cli">cli</a> repo for API docs and check out the
<a href="https://book.babashka.org/#_babashka_cli">babashka CLI</a> chapter on how to use it
from the command line or with <a href="https://book.babashka.org/#tasks">tasks</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_projects"><a class="link" href="#_projects">Projects</a></h3>
<div class="paragraph">
<p>Babashka is able to run Clojure projects from source, if they are compatible
with the subset of Clojure that sci is capable of running.</p>
</div>
<div class="paragraph">
<p>Check this
<a href="https://github.com/borkdude/babashka/blob/master/doc/projects.md">page</a> for
projects that are known to work with babashka.</p>
</div>
<div class="paragraph">
<p>Do you have a library that is compatible with babashka? Add the official badge
to give some flair to your repo!</p>
</div>
<div class="paragraph">
<p><span class="image"><a class="image" href="https://babashka.org"><img src="https://img.shields.io/badge/babashka-compatible-green?logo=data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNDcyIDE0NzIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNOTk1LjkxMSAxMTkzLjg5QzExMTAuOTMgMTExMi4zOCAxMTg2IDk3OC4yMDYgMTE4NiA4MjYuNUMxMTg2IDU3Ny45NzIgMTAxNCAyNTQuNSA3MzYgMTEzQzQ2MC41IDI2MiAyODYgNTc3Ljk3MiAyODYgODI2LjVDMjg2IDk3OC4yMDYgMzYxLjA3IDExMTIuMzggNDc2LjA4OSAxMTkzLjg5QzQ3MS45ODMgMTE5NC40NCA0NjcuOTQ5IDExOTUuMTQgNDY0IDExOTZDMzc2LjYxMSAxMjE1LjA3IDI3MCAxMzU5LjA1IDI3MCAxMzU5LjA1SDUzNEM1ODAuOTcyIDEzNTkuMDUgNjI1LjYzMSAxMzQxLjQxIDY2MC45NTYgMTMyMS42MkM2NzguMTE1IDEzNDQuMzIgNzA1LjM0NCAxMzU5IDczNiAxMzU5Qzc2Ni42NTYgMTM1OSA3OTMuODg1IDEzNDQuMzIgODExLjA0NCAxMzIxLjYyQzg0Ni4zNjkgMTM0MS40MSA4OTEuMDI4IDEzNTkuMDUgOTM4IDEzNTkuMDVIMTIwMkMxMjAyIDEzNTkuMDUgMTA5NS4zOSAxMjE1LjA3IDEwMDggMTE5NkMxMDA0LjA1IDExOTUuMTQgMTAwMC4wMiAxMTk0LjQ0IDk5NS45MTEgMTE5My44OVoiIGZpbGw9InVybCgjcGFpbnQwX2xpbmVhcikiLz4KPGNpcmNsZSBjeD0iNzM1LjUiIGN5PSI4NTIuNSIgcj0iMzExLjUiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik00NDMgNzUwLjQxN0M2NjIgNzY1Ljg2NiA3OTEuMzgyIDcxMi4zODggODgxIDU3OS44ODFDODgxIDU3OS44ODEgNzA4LjI5MyA1MjEuNjQ5IDYwMy4yNDQgNTc5Ljg4MUM0OTguNTUgNjM3LjkxNiA0NDMgNzUwLjQxNyA0NDMgNzUwLjQxN1oiIGZpbGw9IiNCNEI0QjQiLz4KPHBhdGggZD0iTTEwMzkuOTkgNzQ4LjI4MkM5MTQuODYyIDczNC43NDUgODAzLjI2NCA2OTQuMTM1IDc1MCA1NDFDNzUwIDU0MSA4NjAuNjMzIDU2Ni4yNzIgOTcyLjM1NSA2NjguMTAxQzEwODguMzkgNzczLjg1NyAxMDM5Ljk5IDc0OC4yODIgMTAzOS45OSA3NDguMjgyWiIgZmlsbD0iI0I0QjRCNCIvPgo8Y2lyY2xlIGN4PSI3MzUuNSIgY3k9Ijg1Mi41IiByPSIzMTEuNSIgc3Ryb2tlPSIjMEEwMDAwIiBzdHJva2Utd2lkdGg9IjQwIi8+CjxwYXRoIGQ9Ik03OTcgNzE5SDY3NEw3MDQgNzQ5VjgzOUM3MDguNSA4MDkuNSA3NjQuNSA4MDguNSA3NjcuNSA4MzlMNzc1IDc0OUw3OTcgNzE5WiIgZmlsbD0iYmxhY2siLz4KPHBhdGggZD0iTTM1MS4xMTcgNzU5QzM1MS4xMTcgNzM2LjkwOSAzNjkuMDI2IDcxOSAzOTEuMTE3IDcxOUg2NzYuMDE4QzcwMC4yIDcxOSA3MTguODUyIDc0MC4yOTIgNzE1LjY3IDc2NC4yNjRMNjkwLjkxIDk1MC43NjRDNjg4LjI3IDk3MC42NDYgNjcxLjMxNCA5ODUuNSA2NTEuMjU4IDk4NS41SDM5MS4xMTdDMzY5LjAyNiA5ODUuNSAzNTEuMTE3IDk2Ny41OTEgMzUxLjExNyA5NDUuNVY3NTlaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBkPSJNNzU2LjAxMiA3NjQuMjY3Qzc1Mi44MjggNzQwLjI5NCA3NzEuNDgxIDcxOSA3OTUuNjY0IDcxOUgxMDgwQzExMDIuMDkgNzE5IDExMjAgNzM2LjkwOSAxMTIwIDc1OVY5NDUuMDk2QzExMjAgOTY3LjE4NyAxMTAyLjA5IDk4NS4wOTYgMTA4MCA5ODUuMDk2SDgyMC4zODFDODAwLjMyNSA5ODUuMDk2IDc4My4zNyA5NzAuMjQ0IDc4MC43MjkgOTUwLjM2Mkw3NTYuMDEyIDc2NC4yNjdaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBkPSJNMTAyNCA5NTJWOTIxLjQ3SDEwMTMuNzFDMTAwNy4wMyA5MjEuNDcgMTAwMi41OCA5MTYuNzUyIDEwMDAuMzUgOTA5LjgxM0w5NTguMDY0IDc4Mi42OTdDOTU1LjI4MiA3NzQuNjQ5IDk1MS45NDQgNzY4LjgyIDk0Ny40OTIgNzY0LjM3OUM5MzkuMTQ2IDc1NS43NzUgOTI4LjI5NiA3NTMgOTE2LjA1NCA3NTNIOTAyLjdWNzg0LjkxOEg5MTEuNjAzQzkxOS4xMTUgNzg0LjkxOCA5MjQuOTU3IDc4Ny42OTMgOTI3LjQ2MSA3OTYuNTc1TDkzMy4zMDMgODE3LjExM0w4ODEgOTUySDkxOS4xMTVMOTUwLjU1MyA4NjMuMTg1TDk2Ny4yNDUgOTE2Ljc1MkM5NzMuNjQ0IDkzNy41NjggOTg0LjQ5NCA5NTIgMTAwOC45OCA5NTJIMTAyNFoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik01OTAgOTUyVjkyMS40N0g1NzkuNzA2QzU3My4wMjkgOTIxLjQ3IDU2OC41NzggOTE2Ljc1MiA1NjYuMzUyIDkwOS44MTNMNTI0LjA2NCA3ODIuNjk3QzUyMS4yODIgNzc0LjY0OSA1MTcuOTQ0IDc2OC44MiA1MTMuNDkyIDc2NC4zNzlDNTA1LjE0NiA3NTUuNzc1IDQ5NC4yOTYgNzUzIDQ4Mi4wNTQgNzUzSDQ2OC43Vjc4NC45MThINDc3LjYwM0M0ODUuMTE1IDc4NC45MTggNDkwLjk1NyA3ODcuNjkzIDQ5My40NjEgNzk2LjU3NUw0OTkuMzAzIDgxNy4xMTNMNDQ3IDk1Mkg0ODUuMTE1TDUxNi41NTMgODYzLjE4NUw1MzMuMjQ1IDkxNi43NTJDNTM5LjY0NCA5MzcuNTY4IDU1MC40OTQgOTUyIDU3NC45NzcgOTUySDU5MFoiIGZpbGw9IndoaXRlIi8+CjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50MF9saW5lYXIiIHgxPSI3NTIiIHkxPSIxMTMiIHgyPSI3NTIiIHkyPSIxMzU5LjUyIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CjxzdG9wIHN0b3AtY29sb3I9IiNFNDFGMjYiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjQjcwMDAwIi8+CjwvbGluZWFyR3JhZGllbnQ+CjwvZGVmcz4KPC9zdmc+Cg==" alt="svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNDcyIDE0NzIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNOTk1LjkxMSAxMTkzLjg5QzExMTAuOTMgMTExMi4zOCAxMTg2IDk3OC4yMDYgMTE4NiA4MjYuNUMxMTg2IDU3Ny45NzIgMTAxNCAyNTQuNSA3MzYgMTEzQzQ2MC41IDI2MiAyODYgNTc3Ljk3MiAyODYgODI2LjVDMjg2IDk3OC4yMDYgMzYxLjA3IDExMTIuMzggNDc2LjA4OSAxMTkzLjg5QzQ3MS45ODMgMTE5NC40NCA0NjcuOTQ5IDExOTUuMTQgNDY0IDExOTZDMzc2LjYxMSAxMjE1LjA3IDI3MCAxMzU5LjA1IDI3MCAxMzU5LjA1SDUzNEM1ODAuOTcyIDEzNTkuMDUgNjI1LjYzMSAxMzQxLjQxIDY2MC45NTYgMTMyMS42MkM2NzguMTE1IDEzNDQuMzIgNzA1LjM0NCAxMzU5IDczNiAxMzU5Qzc2Ni42NTYgMTM1OSA3OTMuODg1IDEzNDQuMzIgODExLjA0NCAxMzIxLjYyQzg0Ni4zNjkgMTM0MS40MSA4OTEuMDI4IDEzNTkuMDUgOTM4IDEzNTkuMDVIMTIwMkMxMjAyIDEzNTkuMDUgMTA5NS4zOSAxMjE1LjA3IDEwMDggMTE5NkMxMDA0LjA1IDExOTUuMTQgMTAwMC4wMiAxMTk0LjQ0IDk5NS45MTEgMTE5My44OVoiIGZpbGw9InVybCgjcGFpbnQwX2xpbmVhcikiLz4KPGNpcmNsZSBjeD0iNzM1LjUiIGN5PSI4NTIuNSIgcj0iMzExLjUiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik00NDMgNzUwLjQxN0M2NjIgNzY1Ljg2NiA3OTEuMzgyIDcxMi4zODggODgxIDU3OS44ODFDODgxIDU3OS44ODEgNzA4LjI5MyA1MjEuNjQ5IDYwMy4yNDQgNTc5Ljg4MUM0OTguNTUgNjM3LjkxNiA0NDMgNzUwLjQxNyA0NDMgNzUwLjQxN1oiIGZpbGw9IiNCNEI0QjQiLz4KPHBhdGggZD0iTTEwMzkuOTkgNzQ4LjI4MkM5MTQuODYyIDczNC43NDUgODAzLjI2NCA2OTQuMTM1IDc1MCA1NDFDNzUwIDU0MSA4NjAuNjMzIDU2Ni4yNzIgOTcyLjM1NSA2NjguMTAxQzEwODguMzkgNzczLjg1NyAxMDM5Ljk5IDc0OC4yODIgMTAzOS45OSA3NDguMjgyWiIgZmlsbD0iI0I0QjRCNCIvPgo8Y2lyY2xlIGN4PSI3MzUuNSIgY3k9Ijg1Mi41IiByPSIzMTEuNSIgc3Ryb2tlPSIjMEEwMDAwIiBzdHJva2Utd2lkdGg9IjQwIi8+CjxwYXRoIGQ9Ik03OTcgNzE5SDY3NEw3MDQgNzQ5VjgzOUM3MDguNSA4MDkuNSA3NjQuNSA4MDguNSA3NjcuNSA4MzlMNzc1IDc0OUw3OTcgNzE5WiIgZmlsbD0iYmxhY2siLz4KPHBhdGggZD0iTTM1MS4xMTcgNzU5QzM1MS4xMTcgNzM2LjkwOSAzNjkuMDI2IDcxOSAzOTEuMTE3IDcxOUg2NzYuMDE4QzcwMC4yIDcxOSA3MTguODUyIDc0MC4yOTIgNzE1LjY3IDc2NC4yNjRMNjkwLjkxIDk1MC43NjRDNjg4LjI3IDk3MC42NDYgNjcxLjMxNCA5ODUuNSA2NTEuMjU4IDk4NS41SDM5MS4xMTdDMzY5LjAyNiA5ODUuNSAzNTEuMTE3IDk2Ny41OTEgMzUxLjExNyA5NDUuNVY3NTlaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBkPSJNNzU2LjAxMiA3NjQuMjY3Qzc1Mi44MjggNzQwLjI5NCA3NzEuNDgxIDcxOSA3OTUuNjY0IDcxOUgxMDgwQzExMDIuMDkgNzE5IDExMjAgNzM2LjkwOSAxMTIwIDc1OVY5NDUuMDk2QzExMjAgOTY3LjE4NyAxMTAyLjA5IDk4NS4wOTYgMTA4MCA5ODUuMDk2SDgyMC4zODFDODAwLjMyNSA5ODUuMDk2IDc4My4zNyA5NzAuMjQ0IDc4MC43MjkgOTUwLjM2Mkw3NTYuMDEyIDc2NC4yNjdaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBkPSJNMTAyNCA5NTJWOTIxLjQ3SDEwMTMuNzFDMTAwNy4wMyA5MjEuNDcgMTAwMi41OCA5MTYuNzUyIDEwMDAuMzUgOTA5LjgxM0w5NTguMDY0IDc4Mi42OTdDOTU1LjI4MiA3NzQuNjQ5IDk1MS45NDQgNzY4LjgyIDk0Ny40OTIgNzY0LjM3OUM5MzkuMTQ2IDc1NS43NzUgOTI4LjI5NiA3NTMgOTE2LjA1NCA3NTNIOTAyLjdWNzg0LjkxOEg5MTEuNjAzQzkxOS4xMTUgNzg0LjkxOCA5MjQuOTU3IDc4Ny42OTMgOTI3LjQ2MSA3OTYuNTc1TDkzMy4zMDMgODE3LjExM0w4ODEgOTUySDkxOS4xMTVMOTUwLjU1MyA4NjMuMTg1TDk2Ny4yNDUgOTE2Ljc1MkM5NzMuNjQ0IDkzNy41NjggOTg0LjQ5NCA5NTIgMTAwOC45OCA5NTJIMTAyNFoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik01OTAgOTUyVjkyMS40N0g1NzkuNzA2QzU3My4wMjkgOTIxLjQ3IDU2OC41NzggOTE2Ljc1MiA1NjYuMzUyIDkwOS44MTNMNTI0LjA2NCA3ODIuNjk3QzUyMS4yODIgNzc0LjY0OSA1MTcuOTQ0IDc2OC44MiA1MTMuNDkyIDc2NC4zNzlDNTA1LjE0NiA3NTUuNzc1IDQ5NC4yOTYgNzUzIDQ4Mi4wNTQgNzUzSDQ2OC43Vjc4NC45MThINDc3LjYwM0M0ODUuMTE1IDc4NC45MTggNDkwLjk1NyA3ODcuNjkzIDQ5My40NjEgNzk2LjU3NUw0OTkuMzAzIDgxNy4xMTNMNDQ3IDk1Mkg0ODUuMTE1TDUxNi41NTMgODYzLjE4NUw1MzMuMjQ1IDkxNi43NTJDNTM5LjY0NCA5MzcuNTY4IDU1MC40OTQgOTUyIDU3NC45NzcgOTUySDU5MFoiIGZpbGw9IndoaXRlIi8+CjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50MF9saW5lYXIiIHgxPSI3NTIiIHkxPSIxMTMiIHgyPSI3NTIiIHkyPSIxMzU5LjUyIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CjxzdG9wIHN0b3AtY29sb3I9IiNFNDFGMjYiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjQjcwMDAwIi8+CjwvbGluZWFyR3JhZGllbnQ+CjwvZGVmcz4KPC9zdmc+Cg==" title="bb compatible"></a></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pods"><a class="link" href="#pods">Pods</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pods are programs that can be used as a Clojure library by
babashka. Documentation is available in the
<a href="https://github.com/babashka/babashka.pods">library repo</a>.</p>
</div>
<div class="paragraph">
<p>A list of available pods can be found
<a href="https://github.com/borkdude/babashka/blob/master/doc/projects.md#pods">here</a>.</p>
</div>
<div class="sect2">
<h3 id="_pod_registry"><a class="link" href="#_pod_registry">Pod registry</a></h3>
<div class="paragraph">
<p>Since bb 0.2.6 pods can be obtained via the <a href="https://github.com/babashka/pod-registry">pod-registry</a>.</p>
</div>
<div class="paragraph">
<p>This is an example script which uses the
<a href="https://github.com/babashka/pod-babashka-fswatcher">fswatcher</a> pod to
watch a directory for changes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="o">#</span><span class="n">!/usr/bin/env</span><span class="w"> </span><span class="n">bb</span><span class="w">

</span><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">babashka.pods</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">pods</span><span class="p">])</span><span class="w">
</span><span class="p">(</span><span class="nf">pods/load-pod</span><span class="w"> </span><span class="ss">'org.babashka/fswatcher</span><span class="w"> </span><span class="s">"0.0.5"</span><span class="p">)</span><span class="w">

</span><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">pod.babashka.fswatcher</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">fw</span><span class="p">])</span><span class="w">

</span><span class="p">(</span><span class="nf">fw/watch</span><span class="w"> </span><span class="s">"."</span><span class="w"> </span><span class="nb">prn</span><span class="w"> </span><span class="p">{</span><span class="no">:delay-ms</span><span class="w"> </span><span class="mi">5000</span><span class="p">})</span><span class="w">

</span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="s">"Watching current directory for changes... Press Ctrl-C to quit."</span><span class="p">)</span><span class="w">

</span><span class="o">@</span><span class="p">(</span><span class="nf">promise</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pods_in_bb_edn"><a class="link" href="#_pods_in_bb_edn">Pods in bb.edn</a></h3>
<div class="paragraph">
<p>Since bb 0.8.0 pods can be declared in <code>bb.edn</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">{</span><span class="no">:paths</span><span class="w"> </span><span class="p">[</span><span class="s">"bb"</span><span class="p">]</span><span class="w">
 </span><span class="no">:pods</span><span class="w"> </span><span class="p">{</span><span class="n">org.babashka/go-sqlite3</span><span class="w"> </span><span class="p">{</span><span class="no">:version</span><span class="w"> </span><span class="s">"0.2.3"</span><span class="p">}}}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Given the file <code>bb/my_project/db.clj</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">ns</span><span class="w"> </span><span class="n">my-project.db</span><span class="w">
  </span><span class="p">(</span><span class="no">:require</span><span class="w"> </span><span class="p">[</span><span class="n">pod.babashka.go-sqlite3</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">sqlite</span><span class="p">]))</span><span class="w">

</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">-main</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="w"> </span><span class="n">_args</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nb">prn</span><span class="w"> </span><span class="p">(</span><span class="nf">sqlite/query</span><span class="w"> </span><span class="s">":memory:"</span><span class="w"> </span><span class="p">[</span><span class="s">"SELECT 1 + 1 AS sum"</span><span class="p">])))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>you can then execute the main function, without calling <code>load-pod</code> manually:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>bb <span class="nt">-m</span> my-project.db
<span class="o">[{</span>:sum 2<span class="o">}]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="style"><a class="link" href="#style">Style</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A note on style. Babashka recommends the following:</p>
</div>
<div class="sect2">
<h3 id="_explicit_requires"><a class="link" href="#_explicit_requires">Explicit requires</a></h3>
<div class="paragraph">
<p>Use explicit requires with namespace aliases in scripts, unless you&#8217;re
writing one-liners.</p>
</div>
<div class="paragraph">
<p>Do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span><span class="nb">ls</span> | bb <span class="nt">-i</span> <span class="s1">'(-&gt; *input* first (str/includes? "m"))'</span>
<span class="nb">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But not this:</p>
</div>
<div class="paragraph">
<p>script.clj:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nb">-&gt;</span><span class="w"> </span><span class="n">*input*</span><span class="w"> </span><span class="nb">first</span><span class="w"> </span><span class="p">(</span><span class="nf">str/includes?</span><span class="w"> </span><span class="s">"m"</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Rather do this:</p>
</div>
<div class="paragraph">
<p>script.clj:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">ns</span><span class="w"> </span><span class="n">script</span><span class="w">
  </span><span class="p">(</span><span class="no">:require</span><span class="w"> </span><span class="p">[</span><span class="n">clojure.java.io</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">io</span><span class="p">]</span><span class="w">
            </span><span class="p">[</span><span class="n">clojure.string</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="nb">str</span><span class="p">]))</span><span class="w">
</span><span class="p">(</span><span class="nb">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">io/reader</span><span class="w"> </span><span class="n">*in*</span><span class="p">)</span><span class="w"> </span><span class="nb">line-seq</span><span class="w"> </span><span class="nb">first</span><span class="w"> </span><span class="p">(</span><span class="nf">str/includes?</span><span class="w"> </span><span class="s">"m"</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Some reasons for this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Linters like clj-kondo work better with code that uses namespace
forms, explicit requires, and known Clojure constructs</p>
</li>
<li>
<p>Editor tooling works better with namespace forms (sorting requires,
etc).</p>
</li>
<li>
<p>Writing compatible code gives you the option to run the same script
with <code>clojure</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="child_processes"><a class="link" href="#child_processes">Child processes</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>For child processes, the babashka <a href="https://github.com/babashka/process">process</a>
library is recommended. It is built into babashka. Check out the README which
gives a good introduction into the library.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="recipes"><a class="link" href="#recipes">Recipes</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_running_tests"><a class="link" href="#_running_tests">Running tests</a></h3>
<div class="paragraph">
<p>Babashka bundles <code>clojure.test</code>. To run tests you can write a test runner script. Given the following project structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nb">.</span>
 src
   ...
 <span class="nb">test</span>
     your
         test_a.clj
         test_b.clj</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">test-runner.clj</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="o">#</span><span class="n">!/usr/bin/env</span><span class="w"> </span><span class="n">bb</span><span class="w">

</span><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">clojure.test</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">t</span><span class="p">]</span><span class="w">
         </span><span class="o">'</span><span class="p">[</span><span class="n">babashka.classpath</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">cp</span><span class="p">])</span><span class="w">

</span><span class="p">(</span><span class="nf">cp/add-classpath</span><span class="w"> </span><span class="s">"src:test"</span><span class="p">)</span><span class="w">                        <i class="conum" data-value="1"></i><b>(1)</b>

</span><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="ss">'your.test-a</span><span class="w"> </span><span class="ss">'your.test-b</span><span class="p">)</span><span class="w">                  <i class="conum" data-value="2"></i><b>(2)</b>

</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">test-results</span><span class="w">
  </span><span class="p">(</span><span class="nf">t/run-tests</span><span class="w"> </span><span class="ss">'your.test-a</span><span class="w"> </span><span class="ss">'your.test-b</span><span class="p">))</span><span class="w">           <i class="conum" data-value="3"></i><b>(3)</b>

</span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[{</span><span class="no">:keys</span><span class="w"> </span><span class="p">[</span><span class="n">fail</span><span class="w"> </span><span class="n">error</span><span class="p">]}</span><span class="w"> </span><span class="n">test-results</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nb">when</span><span class="w"> </span><span class="p">(</span><span class="nb">pos?</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="n">error</span><span class="p">))</span><span class="w">
    </span><span class="p">(</span><span class="nf">System/exit</span><span class="w"> </span><span class="mi">1</span><span class="p">)))</span><span class="w">                                <i class="conum" data-value="4"></i><b>(4)</b>
</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add sources and tests to the classpath</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Require the test namespaces</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Run all tests in the test namespaces</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Exit the test script with a non-zero exit code when there are failures or errors</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="main_file"><a class="link" href="#main_file">Main file</a></h3>
<div class="paragraph">
<p>In Python scripts there is a well-known pattern to check if the current
file was the file invoked from the command line, or loaded from another
file: the <code>__name__ == "__main__"</code> pattern. In babashka this pattern can
be implemented with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="n">*file*</span><span class="w"> </span><span class="p">(</span><span class="nf">System/getProperty</span><span class="w"> </span><span class="s">"babashka.file"</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Combining this with a conditional invocation of <code>-main</code> creates a script file that is safe to load at a REPL, and easy to invoke at the CLI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="o">#</span><span class="n">!/usr/bin/env</span><span class="w"> </span><span class="n">bb</span><span class="w">

</span><span class="c1">;; Various functions defined here</span><span class="w">

</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">-main</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="w"> </span><span class="n">args</span><span class="p">]</span><span class="w">
</span><span class="c1">;; Implementation of main</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="p">(</span><span class="nb">when</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="n">*file*</span><span class="w"> </span><span class="p">(</span><span class="nf">System/getProperty</span><span class="w"> </span><span class="s">"babashka.file"</span><span class="p">))</span><span class="w">
  </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="n">-main</span><span class="w"> </span><span class="n">*command-line-args*</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be exceedingly handy for editing complex scripts interactively, while not being able to adjust how they are invoked by other tools.</p>
</div>
</div>
<div class="sect2">
<h3 id="_shutdown_hook"><a class="link" href="#_shutdown_hook">Shutdown hook</a></h3>
<div class="paragraph">
<p>Adding a shutdown hook allows you to execute some code before the script
exits.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">$</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="n">-e</span><span class="w"> </span><span class="o">'</span><span class="p">(</span><span class="nb">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">Runtime/getRuntime</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">.addShutdownHook</span><span class="w"> </span><span class="p">(</span><span class="nf">Thread.</span><span class="w"> </span><span class="o">#</span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="s">"bye"</span><span class="p">))))</span><span class="o">'</span><span class="w">
</span><span class="n">bye</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This also works when the script is interrupted with ctrl-c.</p>
</div>
</div>
<div class="sect2">
<h3 id="_printing_returned_values"><a class="link" href="#_printing_returned_values">Printing returned values</a></h3>
<div class="paragraph">
<p>Babashka doesn&#8217;t print a returned <code>nil</code> as lots of scripts end in
something side-effecting.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>bb <span class="nt">-e</span> <span class="s1">'(:a {:a 5})'</span>
5
<span class="nv">$ </span>bb <span class="nt">-e</span> <span class="s1">'(:b {:a 5})'</span>
<span class="err">$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you really want to print the nil, you can use <code>(prn ..)</code> instead.</p>
</div>
<div class="sect3">
<h4 id="_http_over_unix_sockets"><a class="link" href="#_http_over_unix_sockets">HTTP over Unix sockets</a></h4>
<div class="paragraph">
<p>This can be useful for talking to Docker:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">clojure.java.shell</span><span class="w"> </span><span class="no">:refer</span><span class="w"> </span><span class="p">[</span><span class="n">sh</span><span class="p">]])</span><span class="w">
</span><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">cheshire.core</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">json</span><span class="p">])</span><span class="w">
</span><span class="p">(</span><span class="nb">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">sh</span><span class="w"> </span><span class="s">"curl"</span><span class="w"> </span><span class="s">"--silent"</span><span class="w">
        </span><span class="s">"--no-buffer"</span><span class="w"> </span><span class="s">"--unix-socket"</span><span class="w">
        </span><span class="s">"/var/run/docker.sock"</span><span class="w">
        </span><span class="s">"http://localhost/images/json"</span><span class="p">)</span><span class="w">
    </span><span class="no">:out</span><span class="w">
    </span><span class="p">(</span><span class="nf">json/parse-string</span><span class="w"> </span><span class="n">true</span><span class="p">)</span><span class="w">
    </span><span class="nb">first</span><span class="w">
    </span><span class="no">:RepoTags</span><span class="p">)</span><span class="w"> </span><span class="c1">;;=&gt; ["borkdude/babashka:latest"]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="core_async"><a class="link" href="#core_async">Core.async</a></h3>
<div class="paragraph">
<p>In addition to <code>future</code>, <code>pmap</code>, <code>promise</code> and friends, you may use the
<code>clojure.core.async</code> namespace for asynchronous scripting. The following
example shows how to get first available value from two different
processes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="n">bb</span><span class="w"> </span><span class="n">-e</span><span class="w"> </span><span class="o">'</span><span class="w">
</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">async-command</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="w"> </span><span class="n">args</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nf">async/thread</span><span class="w"> </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="n">shell/sh</span><span class="w"> </span><span class="s">"bash"</span><span class="w"> </span><span class="s">"-c"</span><span class="w"> </span><span class="n">args</span><span class="p">)))</span><span class="w">

</span><span class="p">(</span><span class="nb">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">async/alts!!</span><span class="w"> </span><span class="p">[(</span><span class="nf">async-command</span><span class="w"> </span><span class="s">"sleep 2 &amp;&amp; echo process 1"</span><span class="p">)</span><span class="w">
                   </span><span class="p">(</span><span class="nf">async-command</span><span class="w"> </span><span class="s">"sleep 1 &amp;&amp; echo process 2"</span><span class="p">)])</span><span class="w">
    </span><span class="nb">first</span><span class="w"> </span><span class="no">:out</span><span class="w"> </span><span class="n">str/trim</span><span class="w"> </span><span class="nb">println</span><span class="p">)</span><span class="o">'</span><span class="w">
</span><span class="n">process</span><span class="w"> </span><span class="mi">2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Caveat: currently the <code>go</code> macro is available for compatibility with JVM
programs, but the implementation maps to <code>clojure.core.async/thread</code> and
the single exclamation mark operations (<code>&lt;!</code>, <code>&gt;!</code>, etc.) map to the
double exclamation mark operations (<code>&lt;!!</code>, <code>&gt;!!</code>, etc.). It will not
"park" threads, like on the JVM.</p>
</div>
<div class="paragraph">
<p>Examples like the following may still work, but will take a lot more
system resources than on the JVM and will break down for some high value
of <code>n</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">clojure.core.async</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">async</span><span class="p">])</span><span class="w">

</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span><span class="w">

</span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">cs</span><span class="w"> </span><span class="p">(</span><span class="nf">repeatedly</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="n">async/chan</span><span class="p">)</span><span class="w">
      </span><span class="n">begin</span><span class="w"> </span><span class="p">(</span><span class="nf">System/currentTimeMillis</span><span class="p">)]</span><span class="w">
  </span><span class="p">(</span><span class="nb">doseq</span><span class="w"> </span><span class="p">[</span><span class="n">c</span><span class="w"> </span><span class="n">cs</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="nf">async/go</span><span class="w"> </span><span class="p">(</span><span class="nf">async/&gt;!</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="s">"hi"</span><span class="p">)))</span><span class="w">
  </span><span class="p">(</span><span class="nb">dotimes</span><span class="w"> </span><span class="p">[</span><span class="n">_</span><span class="w"> </span><span class="n">n</span><span class="p">]</span><span class="w">
    </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[[</span><span class="n">v</span><span class="w"> </span><span class="n">_</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="nf">async/alts!!</span><span class="w"> </span><span class="n">cs</span><span class="p">)]</span><span class="w">
      </span><span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="s">"hi"</span><span class="w"> </span><span class="n">v</span><span class="p">))))</span><span class="w">
  </span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="s">"Read"</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="s">"msgs in"</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="p">(</span><span class="nf">System/currentTimeMillis</span><span class="p">)</span><span class="w"> </span><span class="n">begin</span><span class="p">)</span><span class="w"> </span><span class="s">"ms"</span><span class="p">))</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_interacting_with_an_nrepl_server"><a class="link" href="#_interacting_with_an_nrepl_server">Interacting with an nREPL server</a></h3>
<div class="paragraph">
<p>Babashka comes with the <a href="https://github.com/nrepl/bencode">nrepl/bencode</a>
library which allows you to read and write bencode messages to a socket.
A simple example which evaluates a Clojure expression on an nREPL server
started with <code>lein repl</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="p">(</span><span class="nf">ns</span><span class="w"> </span><span class="n">nrepl-client</span><span class="w">
  </span><span class="p">(</span><span class="no">:require</span><span class="w"> </span><span class="p">[</span><span class="n">bencode.core</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">b</span><span class="p">]))</span><span class="w">

</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">nrepl-eval</span><span class="w"> </span><span class="p">[</span><span class="n">port</span><span class="w"> </span><span class="n">expr</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">s</span><span class="w"> </span><span class="p">(</span><span class="nf">java.net.Socket.</span><span class="w"> </span><span class="s">"localhost"</span><span class="w"> </span><span class="n">port</span><span class="p">)</span><span class="w">
        </span><span class="n">out</span><span class="w"> </span><span class="p">(</span><span class="nf">.getOutputStream</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w">
        </span><span class="n">in</span><span class="w"> </span><span class="p">(</span><span class="nf">java.io.PushbackInputStream.</span><span class="w"> </span><span class="p">(</span><span class="nf">.getInputStream</span><span class="w"> </span><span class="n">s</span><span class="p">))</span><span class="w">
        </span><span class="n">_</span><span class="w"> </span><span class="p">(</span><span class="nf">b/write-bencode</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="p">{</span><span class="s">"op"</span><span class="w"> </span><span class="s">"eval"</span><span class="w"> </span><span class="s">"code"</span><span class="w"> </span><span class="n">expr</span><span class="p">})</span><span class="w">
        </span><span class="n">bytes</span><span class="w"> </span><span class="p">(</span><span class="nb">get</span><span class="w"> </span><span class="p">(</span><span class="nf">b/read-bencode</span><span class="w"> </span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="s">"value"</span><span class="p">)]</span><span class="w">
    </span><span class="p">(</span><span class="nf">String.</span><span class="w"> </span><span class="n">bytes</span><span class="p">)))</span><span class="w">

</span><span class="p">(</span><span class="nf">nrepl-eval</span><span class="w"> </span><span class="mi">52054</span><span class="w"> </span><span class="s">"(+ 1 2 3)"</span><span class="p">)</span><span class="w"> </span><span class="c1">;;=&gt; "6"</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_from_cygwingit_bash"><a class="link" href="#_running_from_cygwingit_bash">Running from Cygwin/Git Bash</a></h3>
<div class="paragraph">
<p>On Windows, <code>bb</code> can be invoked from the bash shell directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>bb <span class="nt">-e</span> <span class="s1">'(+ 1 2 3)'</span>
6</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, creating a script that invokes <code>bb</code> via a shebang leads to an error if
the script is not in the current directory. Suppose you had the following script
named <code>hello</code> on your path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="o">#</span><span class="n">!/usr/bin/env</span><span class="w"> </span><span class="n">bb</span><span class="w">
</span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="s">"Hello, world!"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span>hello
<span class="nt">-----</span> Error <span class="nt">--------------------------------------------------------------------</span>
Type:     java.lang.Exception
Message:  File does not exist: /cygdrive/c/path/to/hello</code></pre>
</div>
</div>
<div class="paragraph">
<p>The problem here is that the shell is passing a Cygwin-style path to <code>bb</code>, but
<code>bb</code> can&#8217;t recognize it because it wasn&#8217;t compiled with Cygwin.</p>
</div>
<div class="paragraph">
<p>The solution is to create a wrapper script that converts the Cygwin-style path
to a Windows-style path before invoking <code>bb</code>. Put the following into a script
called <code>bbwrap</code> somewhere on your Cygwin path, say in <code>/usr/local/bin/bbwrap</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c">#!/bin/bash</span>
<span class="nv">SCRIPT</span><span class="o">=</span><span class="nv">$1</span>
<span class="nb">shift
</span>bb.exe <span class="si">$(</span>cygpath <span class="nt">-w</span> <span class="nv">$SCRIPT</span><span class="si">)</span> <span class="nv">$@</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure to fix your original script to invoke <code>bbwrap</code> instead of <code>bb</code>
directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="clojure"><span class="o">#</span><span class="n">!/usr/bin/env</span><span class="w"> </span><span class="n">bbwrap</span><span class="w">
</span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="s">"Hello, world!"</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="differences-with-clojure"><a class="link" href="#differences-with-clojure">Differences with Clojure</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Babashka is implemented using the <a href="https://github.com/borkdude/sci">Small
Clojure Interpreter</a>. This means that a snippet or script is not
compiled to JVM bytecode, but executed form by form by a runtime which
implements a substantial subset of Clojure. Babashka is compiled to a
native binary using <a href="https://github.com/oracle/graal">GraalVM</a>. It comes
with a selection of built-in namespaces and functions from Clojure and
other useful libraries. The data types (numbers, strings, persistent
collections) are the same. Multi-threading is supported (<code>pmap</code>,
<code>future</code>).</p>
</div>
<div class="paragraph">
<p>Differences with Clojure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A pre-selected set of Java classes are supported. You cannot add Java
classes at runtime.</p>
</li>
<li>
<p>Interpretation comes with overhead. Therefore loops are slower than in
Clojure on the JVM. In general interpretation yields slower programs
than compiled programs.</p>
</li>
<li>
<p>No <code>deftype</code>, <code>definterface</code> and unboxed math.</p>
</li>
<li>
<p><code>defprotocol</code> and <code>defrecord</code> are implemented using multimethods and
regular maps. Ostensibly they work the same, but under the hood there
are no Java classes that correspond to them.</p>
</li>
<li>
<p>Currently <code>reify</code> works only for one class at a time</p>
</li>
<li>
<p>The <code>clojure.core.async/go</code> macro is not (yet) supported. For
compatibility it currently maps to <code>clojure.core.async/thread</code>. More
info <a href="#core_async">here</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="resources"><a class="link" href="#resources">Resources</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Check out the list of resources in babashka&#8217;s <a href="https://github.com/babashka/babashka#articles-podcasts-and-videos">README.md</a>.</p>
</div>
<div class="sect2">
<h3 id="_books"><a class="link" href="#_books">Books</a></h3>
<div class="sect3">
<h4 id="_babashka_babooka"><a class="link" href="#_babashka_babooka"><a href="https://www.braveclojure.com/quests/babooka/">Babashka Babooka</a></a></h4>
<div class="paragraph">
<p>If youre a fan of
<a href="https://www.braveclojure.com/clojure-for-the-brave-and-true/">Clojure for the
Brave and True</a>, you might enjoy
<a href="https://www.braveclojure.com/quests/babooka/">Babashka Babooka</a>, a book by the
same author, Daniel Higginbotham!</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="contributing"><a class="link" href="#contributing">Contributing</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Visit Babashka book&#8217;s <a href="https://github.com/babashka/book">Github repository</a> and
make an issue and/or PR.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="license"><a class="link" href="#license">License</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Copyright  2020-2021 Michiel Borkent</p>
</div>
<div class="paragraph">
<p>Licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-01-23 15:27:14 +0100
</div>
</div>
<!-- see https://github.com/asciidoctor/asciidoctor/issues/699#issuecomment-321066006 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.min.js"></script>
<script>
  /* Tocbot dynamic TOC, works with tocbot 3.0.2 */
  var oldtoc = document.getElementById('toctitle').nextElementSibling;
  var newtoc = document.createElement('div');
  newtoc.setAttribute('id', 'tocbot');
  newtoc.setAttribute('class', 'js-toc');
  oldtoc.parentNode.replaceChild(newtoc, oldtoc);
  tocbot.init({ contentSelector: '#content',
                headingSelector: 'h1, h2, h3, h4',
                scrollSmooth: false });
  var handleTocOnResize = function() {
    var width = window.innerWidth
        || document.documentElement.clientWidth
        || document.body.clientWidth;
    if (width < 768) {
      tocbot.refresh({ contentSelector: '#content',
                       headingSelector: 'h1, h2, h3, h4',
                       //collapseDepth: 6,
                       //activeLinkClass: 'ignoreactive',
                       //throttleTimeout: 1000,
                       scrollSmooth: false });
    }
    else {
      tocbot.refresh({ contentSelector: '#content',
                       headingSelector: 'h1, h2, h3, h4',
                       scrollSmooth: false });
    }
  };
  window.addEventListener('resize', handleTocOnResize);
  handleTocOnResize();

  // responsive menu toggle
  var $toggle_button = document.createElement('label');
  var $body = document.querySelector('body');
  var menu_toggle_handler = function(e) {
    $body.classList.toggle('shownav');
  };
  $toggle_button.classList.add('toggle-button');
  $toggle_button.setAttribute('type', 'button');
  $toggle_button.innerHTML = "Menu";
  $toggle_button.addEventListener('click', menu_toggle_handler);
  $body.appendChild($toggle_button);
  var register_menu_toggle = function() {
    var $menu_links = document.querySelectorAll('a.toc-link');
    $menu_links.forEach(function($menu_link) {
      $menu_link.addEventListener('click', menu_toggle_handler);
    });
  };
  window.addEventListener('resize', register_menu_toggle);
  register_menu_toggle();

</script>
</body>
</html>
