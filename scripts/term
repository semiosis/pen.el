#!/bin/bash
export TTY

sn="$(basename -- "$0")"

unset TMUX

while [ $# -gt 0 ]; do opt="$1"; case "$opt" in
    "") { shift; }; ;;
    -tm) {
        USE_TMUX=y
        shift
    }
    ;;

    *) break;
esac; done

if test "$USE_TMUX" = "y"; then
    "$sn" tmux new -s "$(cmd "$@" | slugify)" "$@"
    exit "$?"
fi

if test "$#" -gt 0; then
    CMD="$(cmd "$@")"
    : ${CMD:="$(cmd "$@")"}
    # I had problems with cmd-nice-posix while this used sh rather than bash
    TERM="$sn" bash -c "$CMD"
else
    TERM="$sn" bash
fi
