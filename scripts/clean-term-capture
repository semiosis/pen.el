#!/bin/bash
export TTY

while [ $# -gt 0 ]; do opt="$1"; case "$opt" in
    "") { shift; }; ;;
    -rmtm) {
        rm_tmux=y
        shift
    }
    ;;

    *) break;
esac; done

(
if test "$rm_tmux" = "y"; then
    sed -z 's/\n\[ .*//'
else
    cat
fi
) | sed -e 's/[]/ /g' \
    -e 's/[も粹尖扳]/ /g' \
    -e 's/ 路\+$//g' |
sed -e ':loop' -e 's/^\( *\) 路 /\1   /g' -e 't loop' |
sed -e 's/\( 路\)\+ *$//g' ` # jupyter tui ` \
    -e 's/\( 路\)\+ *$/ /g' ` # jupyter tui ` \
    -e 's/\s\+$//g' ` # remove trailing whitespace ` |
    -e '/^\~$/d' ` # vim ` \
    sed -e :a -e '/^\n*$/{$d;N;};/\n$/ba'


# -e 's/^  \(路 \)\+//g' ` # jupyter tui ` \
# -e 's/^ \(路 \)\+/ /g' ` # jupyter tui ` \

# piping into cat here breaks it. It creates a race
# condition with the outer cat, or something. Do not do
# this.
# | cat   